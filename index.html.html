<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aplikasi Manajemen Aset</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            box-sizing: border-box;
        }
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            padding: 12px 24px;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            animation: slideIn 0.3s ease-out;
        }
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        .toast.success { background-color: #10b981; }
        .toast.error { background-color: #ef4444; }
        .toast.info { background-color: #3b82f6; }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-full">
    <div id="app" class="min-h-full">
        <!-- Header -->
        <header class="bg-white shadow-lg border-b-4 border-blue-500">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between items-center py-4">
                    <div class="flex items-center">
                        <div class="bg-blue-500 text-white p-2 rounded-lg mr-3">
                            <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M4 4a2 2 0 00-2 2v1h16V6a2 2 0 00-2-2H4zM18 9H2v5a2 2 0 002 2h12a2 2 0 002-2V9zM4 13a1 1 0 011-1h1a1 1 0 110 2H5a1 1 0 01-1-1zm5-1a1 1 0 100 2h1a1 1 0 100-2H9z"/>
                            </svg>
                        </div>
                        <div>
                            <h1 class="text-2xl font-bold text-gray-900">Manajemen Aset</h1>
                            <p class="text-sm text-gray-600">Sistem Pengelolaan Aset Terintegrasi</p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-4">
                        <div class="text-right">
                            <p class="text-sm text-gray-600">Status Database</p>
                            <p id="dbStatus" class="text-sm font-semibold text-green-600">Online ✓</p>
                        </div>
                        <div class="text-right">
                            <p class="text-sm text-gray-600">User Online</p>
                            <p class="text-sm font-semibold text-blue-600">
                                <span id="connectedUsers">1</span> 
                                <svg class="w-4 h-4 inline ml-1" fill="currentColor" viewBox="0 0 20 20">
                                    <path d="M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3z"/>
                                </svg>
                            </p>
                        </div>
                        <div class="text-right">
                            <p class="text-sm text-gray-600">Sinkronisasi</p>
                            <p id="syncStatus" class="text-sm font-medium text-green-600">Sinkronisasi aktif</p>
                            <p class="text-xs text-gray-500">Terakhir: <span id="lastSyncTime">--:--:--</span></p>
                            <p id="networkStatus" class="text-xs text-blue-600">Mendeteksi jaringan...</p>
                        </div>
                        <button onclick="backupToGoogleDrive()" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg font-medium transition-colors">
                            Backup Data
                        </button>
                        <button onclick="restoreFromBackup()" class="bg-orange-500 hover:bg-orange-600 text-white px-4 py-2 rounded-lg font-medium transition-colors">
                            Ambil Data Backup
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Navigation -->
        <nav class="bg-white shadow-sm border-b">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex space-x-8">
                    <button onclick="showMenu('beranda')" class="nav-btn py-4 px-2 border-b-2 border-blue-500 text-blue-600 font-medium">
                        Beranda
                    </button>
                    <button onclick="showMenu('entri-data')" class="nav-btn py-4 px-2 border-b-2 border-transparent text-gray-500 hover:text-gray-700 font-medium">
                        Data Aset
                    </button>
                    <button onclick="showMenu('rekap-aset')" class="nav-btn py-4 px-2 border-b-2 border-transparent text-gray-500 hover:text-gray-700 font-medium">
                        Rekap Aset
                    </button>
                    <button onclick="showMenu('laporan')" class="nav-btn py-4 px-2 border-b-2 border-transparent text-gray-500 hover:text-gray-700 font-medium">
                        Laporan
                    </button>
                    <button onclick="showMenu('kondisi-aset')" class="nav-btn py-4 px-2 border-b-2 border-transparent text-gray-500 hover:text-gray-700 font-medium">
                        Kondisi Aset
                    </button>
                    <button onclick="showMenu('tracking-barang')" class="nav-btn py-4 px-2 border-b-2 border-transparent text-gray-500 hover:text-gray-700 font-medium">
                        Tracking Barang
                    </button>
                </div>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <!-- Beranda -->
            <div id="beranda" class="menu-content fade-in">
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <div class="bg-white rounded-xl shadow-lg p-6 border-l-4 border-blue-500">
                        <div class="flex items-center">
                            <div class="bg-blue-100 p-3 rounded-full">
                                <svg class="w-8 h-8 text-blue-600" fill="currentColor" viewBox="0 0 20 20">
                                    <path d="M4 4a2 2 0 00-2 2v1h16V6a2 2 0 00-2-2H4zM18 9H2v5a2 2 0 002 2h12a2 2 0 002-2V9z"/>
                                </svg>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-600">Total Aset</p>
                                <p id="totalAset" class="text-2xl font-bold text-gray-900">0</p>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white rounded-xl shadow-lg p-6 border-l-4 border-green-500">
                        <div class="flex items-center">
                            <div class="bg-green-100 p-3 rounded-full">
                                <svg class="w-8 h-8 text-green-600" fill="currentColor" viewBox="0 0 20 20">
                                    <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                </svg>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-600">Aset Aktif</p>
                                <p id="asetAktif" class="text-2xl font-bold text-gray-900">0</p>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white rounded-xl shadow-lg p-6 border-l-4 border-yellow-500">
                        <div class="flex items-center">
                            <div class="bg-yellow-100 p-3 rounded-full">
                                <svg class="w-8 h-8 text-yellow-600" fill="currentColor" viewBox="0 0 20 20">
                                    <path d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92z"/>
                                </svg>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-600">Perlu Perawatan</p>
                                <p id="asetPerawatan" class="text-2xl font-bold text-gray-900">0</p>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white rounded-xl shadow-lg p-6 border-l-4 border-purple-500">
                        <div class="flex items-center">
                            <div class="bg-purple-100 p-3 rounded-full">
                                <svg class="w-8 h-8 text-purple-600" fill="currentColor" viewBox="0 0 20 20">
                                    <path d="M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3z"/>
                                </svg>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm font-medium text-gray-600">Total Pengguna</p>
                                <p id="totalPengguna" class="text-2xl font-bold text-gray-900">0</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <div class="lg:col-span-2 bg-white rounded-xl shadow-lg p-6">
                        <h2 class="text-xl font-bold text-gray-900 mb-4">Selamat Datang di Sistem Manajemen Aset</h2>
                        <p class="text-gray-600 mb-4">
                            Sistem ini membantu Anda mengelola aset organisasi dengan fitur lengkap termasuk pencatatan, 
                            pemantauan kondisi, dan pelaporan yang terintegrasi dengan sinkronisasi real-time.
                        </p>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="border rounded-lg p-4">
                                <h3 class="font-semibold text-gray-900 mb-2">Fitur Utama:</h3>
                                <ul class="text-sm text-gray-600 space-y-1">
                                    <li>• Pencatatan data aset lengkap</li>
                                    <li>• Manajemen pengguna aset</li>
                                    <li>• Pemantauan kondisi aset</li>
                                    <li>• Laporan dan rekap otomatis</li>
                                    <li>• <span class="text-blue-600 font-medium">Sinkronisasi real-time</span></li>
                                    <li>• Backup otomatis ke Google Drive</li>
                                </ul>
                            </div>
                            <div class="border rounded-lg p-4">
                                <h3 class="font-semibold text-gray-900 mb-2">Database Status:</h3>
                                <div class="text-sm text-gray-600 space-y-1">
                                    <p>Mode: <span class="font-medium text-green-600">Online & Offline</span></p>
                                    <p>Backup Terakhir: <span id="lastBackup" class="font-medium">Belum ada</span></p>
                                    <p>Sinkronisasi: <span class="font-medium text-blue-600">Realtime</span></p>
                                    <p>User ID: <span id="currentUserId" class="font-mono text-xs bg-gray-100 px-2 py-1 rounded">Loading...</span></p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h3 class="text-lg font-bold text-gray-900 mb-4 flex items-center">
                            <div class="w-3 h-3 bg-green-500 rounded-full mr-2 animate-pulse"></div>
                            Aktivitas Real-time
                        </h3>
                        <div id="activityFeed" class="space-y-3 max-h-80 overflow-y-auto">
                            <div class="text-sm text-gray-500 text-center py-4">
                                Menunggu aktivitas...
                            </div>
                        </div>
                        <div class="mt-4 pt-4 border-t border-gray-200">
                            <div class="flex items-center justify-between text-xs text-gray-500">
                                <span>Auto-refresh setiap 2 detik</span>
                                <div class="flex items-center">
                                    <div class="w-2 h-2 bg-green-500 rounded-full mr-1 animate-pulse"></div>
                                    <span>Live</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Entri Data Aset -->
            <div id="entri-data" class="menu-content hidden">
                <div class="bg-white rounded-xl shadow-lg">
                    <div class="border-b border-gray-200">
                        <nav class="flex space-x-8 px-6">
                            <button onclick="showSubMenu('data-aset')" class="sub-nav-btn py-4 px-2 border-b-2 border-blue-500 text-blue-600 font-medium">
                                Entri Data Aset
                            </button>
                            <button onclick="showSubMenu('pengguna-aset')" class="sub-nav-btn py-4 px-2 border-b-2 border-transparent text-gray-500 hover:text-gray-700 font-medium">
                                Pengguna Aset
                            </button>
                        </nav>
                    </div>

                    <!-- Data Aset Form -->
                    <div id="data-aset" class="sub-menu-content p-8 bg-gradient-to-br from-blue-50 to-indigo-50">
                        <div class="max-w-6xl mx-auto">
                            <div class="text-center mb-8">
                                <h2 class="text-3xl font-bold text-gray-900 mb-2">Tambah Data Aset Baru</h2>
                                <p class="text-gray-600">Lengkapi informasi aset dengan detail yang akurat</p>
                            </div>
                            
                            <div class="bg-white rounded-2xl shadow-xl p-8 border border-gray-100">
                                <form id="asetForm" class="space-y-8">
                                    <!-- Section 1: Informasi Dasar -->
                                    <div class="border-b border-gray-200 pb-8">
                                        <h3 class="text-lg font-semibold text-gray-900 mb-6 flex items-center">
                                            <div class="bg-blue-500 text-white rounded-full w-8 h-8 flex items-center justify-center mr-3 text-sm font-bold">1</div>
                                            Informasi Dasar
                                        </h3>
                                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                            <div>
                                                <label for="nomorUrut" class="block text-sm font-medium text-gray-700 mb-2">Nomor Urut</label>
                                                <input type="text" id="nomorUrut" name="nomorUrut" readonly class="w-full px-4 py-3 border border-gray-300 rounded-xl bg-gray-50 text-gray-600 font-medium">
                                            </div>
                                            <div>
                                                <label for="jenisBarang" class="block text-sm font-medium text-gray-700 mb-2">Jenis Barang <span class="text-red-500">*</span></label>
                                                <input type="text" id="jenisBarang" name="jenisBarang" required class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all">
                                            </div>
                                            <div>
                                                <label for="kodeBarang" class="block text-sm font-medium text-gray-700 mb-2">Kode Barang <span class="text-red-500">*</span></label>
                                                <input type="text" id="kodeBarang" name="kodeBarang" required class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all">
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Section 2: Dokumen -->
                                    <div class="border-b border-gray-200 pb-8">
                                        <h3 class="text-lg font-semibold text-gray-900 mb-6 flex items-center">
                                            <div class="bg-green-500 text-white rounded-full w-8 h-8 flex items-center justify-center mr-3 text-sm font-bold">2</div>
                                            Dokumen Pendukung
                                        </h3>
                                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                                            <div>
                                                <label for="bast" class="block text-sm font-medium text-gray-700 mb-2">BAST</label>
                                                <input type="text" id="bast" name="bast" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all">
                                            </div>
                                            <div>
                                                <label for="tanggalBast" class="block text-sm font-medium text-gray-700 mb-2">Tanggal BAST</label>
                                                <input type="date" id="tanggalBast" name="tanggalBast" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all">
                                            </div>
                                            <div>
                                                <label for="sp2d" class="block text-sm font-medium text-gray-700 mb-2">SP2D</label>
                                                <input type="text" id="sp2d" name="sp2d" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all">
                                            </div>
                                            <div>
                                                <label for="tanggalSp2d" class="block text-sm font-medium text-gray-700 mb-2">Tanggal SP2D</label>
                                                <input type="date" id="tanggalSp2d" name="tanggalSp2d" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all">
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Section 3: Spesifikasi -->
                                    <div class="border-b border-gray-200 pb-8">
                                        <h3 class="text-lg font-semibold text-gray-900 mb-6 flex items-center">
                                            <div class="bg-purple-500 text-white rounded-full w-8 h-8 flex items-center justify-center mr-3 text-sm font-bold">3</div>
                                            Spesifikasi Barang
                                        </h3>
                                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                            <div>
                                                <label for="merkType" class="block text-sm font-medium text-gray-700 mb-2">Merk/Type <span class="text-red-500">*</span></label>
                                                <input type="text" id="merkType" name="merkType" required class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all">
                                            </div>
                                            <div>
                                                <label for="ukuranCc" class="block text-sm font-medium text-gray-700 mb-2">Ukuran/CC</label>
                                                <input type="text" id="ukuranCc" name="ukuranCc" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all">
                                            </div>
                                            <div>
                                                <label for="bahan" class="block text-sm font-medium text-gray-700 mb-2">Bahan</label>
                                                <input type="text" id="bahan" name="bahan" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all">
                                            </div>
                                            <div>
                                                <label for="tahunPembelian" class="block text-sm font-medium text-gray-700 mb-2">Tahun Pembelian <span class="text-red-500">*</span></label>
                                                <input type="number" id="tahunPembelian" name="tahunPembelian" required min="1900" max="2099" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all">
                                            </div>
                                            <div>
                                                <label for="namaPabrik" class="block text-sm font-medium text-gray-700 mb-2">Nama Pabrik</label>
                                                <input type="text" id="namaPabrik" name="namaPabrik" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all">
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Section 4: Identifikasi Kendaraan -->
                                    <div class="border-b border-gray-200 pb-8">
                                        <h3 class="text-lg font-semibold text-gray-900 mb-6 flex items-center">
                                            <div class="bg-orange-500 text-white rounded-full w-8 h-8 flex items-center justify-center mr-3 text-sm font-bold">4</div>
                                            Identifikasi Kendaraan (Opsional)
                                        </h3>
                                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                                            <div>
                                                <label for="nomorRangka" class="block text-sm font-medium text-gray-700 mb-2">Nomor Rangka</label>
                                                <input type="text" id="nomorRangka" name="nomorRangka" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all">
                                            </div>
                                            <div>
                                                <label for="nomorMesin" class="block text-sm font-medium text-gray-700 mb-2">Nomor Mesin</label>
                                                <input type="text" id="nomorMesin" name="nomorMesin" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all">
                                            </div>
                                            <div>
                                                <label for="nomorPolisi" class="block text-sm font-medium text-gray-700 mb-2">Nomor Polisi</label>
                                                <input type="text" id="nomorPolisi" name="nomorPolisi" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all">
                                            </div>
                                            <div>
                                                <label for="nomorBpkb" class="block text-sm font-medium text-gray-700 mb-2">Nomor BPKB</label>
                                                <input type="text" id="nomorBpkb" name="nomorBpkb" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all">
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Section 5: Keuangan -->
                                    <div class="border-b border-gray-200 pb-8">
                                        <h3 class="text-lg font-semibold text-gray-900 mb-6 flex items-center">
                                            <div class="bg-red-500 text-white rounded-full w-8 h-8 flex items-center justify-center mr-3 text-sm font-bold">5</div>
                                            Informasi Keuangan
                                        </h3>
                                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                            <div>
                                                <label for="sumberPerolehan" class="block text-sm font-medium text-gray-700 mb-2">Sumber Perolehan <span class="text-red-500">*</span></label>
                                                <select id="sumberPerolehan" name="sumberPerolehan" required class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all">
                                                    <option value="">Pilih Sumber Perolehan</option>
                                                    <option value="APBN">APBN</option>
                                                    <option value="APBD">APBD</option>
                                                    <option value="Hibah">Hibah</option>
                                                    <option value="Swadaya">Swadaya</option>
                                                    <option value="Bantuan">Bantuan</option>
                                                    <option value="Lainnya">Lainnya</option>
                                                </select>
                                            </div>
                                            <div>
                                                <label for="jumlah" class="block text-sm font-medium text-gray-700 mb-2">Jumlah <span class="text-red-500">*</span></label>
                                                <input type="number" id="jumlah" name="jumlah" required min="1" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all">
                                            </div>
                                            <div>
                                                <label for="biayaUmum" class="block text-sm font-medium text-gray-700 mb-2">Biaya Umum (Rp)</label>
                                                <input type="number" id="biayaUmum" name="biayaUmum" min="0" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all">
                                            </div>
                                            <div>
                                                <label for="hargaSatuan" class="block text-sm font-medium text-gray-700 mb-2">Harga Satuan (Rp) <span class="text-red-500">*</span></label>
                                                <input type="number" id="hargaSatuan" name="hargaSatuan" required min="0" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all">
                                            </div>
                                            <div>
                                                <label for="totalHarga" class="block text-sm font-medium text-gray-700 mb-2">Total Harga (Rp)</label>
                                                <input type="text" id="totalHarga" name="totalHarga" readonly class="w-full px-4 py-3 border border-gray-300 rounded-xl bg-gray-50 text-gray-600 font-bold text-lg">
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Section 6: Keterangan -->
                                    <div class="pb-8">
                                        <h3 class="text-lg font-semibold text-gray-900 mb-6 flex items-center">
                                            <div class="bg-indigo-500 text-white rounded-full w-8 h-8 flex items-center justify-center mr-3 text-sm font-bold">6</div>
                                            Keterangan Tambahan
                                        </h3>
                                        <div>
                                            <label for="keterangan" class="block text-sm font-medium text-gray-700 mb-2">Keterangan</label>
                                            <textarea id="keterangan" name="keterangan" rows="4" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all" placeholder="Tambahkan keterangan atau catatan khusus..."></textarea>
                                        </div>
                                    </div>

                                    <!-- Action Buttons -->
                                    <div class="flex flex-col sm:flex-row gap-4 pt-6 border-t border-gray-200">
                                        <button type="submit" class="flex-1 bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white px-8 py-4 rounded-xl font-semibold transition-all transform hover:scale-105 shadow-lg">
                                            <svg class="w-5 h-5 inline mr-2" fill="currentColor" viewBox="0 0 20 20">
                                                <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                                            </svg>
                                            Simpan Data Aset
                                        </button>
                                        <button type="button" onclick="resetForm('asetForm')" class="flex-1 bg-gradient-to-r from-gray-500 to-gray-600 hover:from-gray-600 hover:to-gray-700 text-white px-8 py-4 rounded-xl font-semibold transition-all transform hover:scale-105 shadow-lg">
                                            <svg class="w-5 h-5 inline mr-2" fill="currentColor" viewBox="0 0 20 20">
                                                <path fill-rule="evenodd" d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z" clip-rule="evenodd"/>
                                            </svg>
                                            Reset Form
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>

                    <!-- Pengguna Aset Form -->
                    <div id="pengguna-aset" class="sub-menu-content hidden p-6">
                        <h2 class="text-xl font-bold text-gray-900 mb-6">Tambah Pengguna Aset</h2>
                        <form id="penggunaForm" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label for="namaBarangPengguna" class="block text-sm font-medium text-gray-700 mb-2">Nama Barang</label>
                                <select id="namaBarangPengguna" name="namaBarangPengguna" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                    <option value="">Pilih Barang</option>
                                </select>
                            </div>
                            <div>
                                <label for="kodeBarangPengguna" class="block text-sm font-medium text-gray-700 mb-2">Kode Barang</label>
                                <input type="text" id="kodeBarangPengguna" name="kodeBarangPengguna" readonly class="w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-50">
                            </div>
                            <div>
                                <label for="nomorRegisterPengguna" class="block text-sm font-medium text-gray-700 mb-2">Nomor Register</label>
                                <input type="text" id="nomorRegisterPengguna" name="nomorRegisterPengguna" readonly class="w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-50">
                            </div>
                            <div>
                                <label for="namaPengguna" class="block text-sm font-medium text-gray-700 mb-2">Nama Pengguna</label>
                                <input type="text" id="namaPengguna" name="namaPengguna" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            </div>
                            <div>
                                <label for="jumlahPengguna" class="block text-sm font-medium text-gray-700 mb-2">Jumlah</label>
                                <input type="number" id="jumlahPengguna" name="jumlahPengguna" required min="1" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            </div>
                            <div>
                                <label for="lokasi" class="block text-sm font-medium text-gray-700 mb-2">Lokasi</label>
                                <input type="text" id="lokasi" name="lokasi" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            </div>
                            <div class="md:col-span-2">
                                <button type="submit" class="bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-lg font-medium transition-colors">
                                    Simpan Data Pengguna
                                </button>
                                <button type="button" onclick="resetForm('penggunaForm')" class="ml-3 bg-gray-500 hover:bg-gray-600 text-white px-6 py-3 rounded-lg font-medium transition-colors">
                                    Reset Form
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Rekap Aset -->
            <div id="rekap-aset" class="menu-content hidden">
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-xl font-bold text-gray-900">Rekap Data Aset</h2>
                        <div class="flex space-x-3">
                            <input type="text" id="searchAset" placeholder="Cari aset..." class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            <button onclick="exportToExcel()" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg font-medium transition-colors">
                                Export Excel
                            </button>
                        </div>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gradient-to-r from-blue-50 to-indigo-50">
                                <tr>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">No</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">Jenis Barang</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">Kode</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">BAST</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">Tgl BAST</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">SP2D</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">Tgl SP2D</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">Merk/Type</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">Ukuran/CC</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">Bahan</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">Tahun</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">Pabrik</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">No Rangka</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">No Mesin</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">No Polisi</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">No BPKB</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">Sumber</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">Jumlah</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">Biaya Umum</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">Harga Satuan</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">Total Harga</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">Keterangan</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">Kondisi</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="asetTableBody" class="bg-white divide-y divide-gray-200">
                                <!-- Data akan diisi oleh JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Laporan -->
            <div id="laporan" class="menu-content hidden">
                <div class="bg-white rounded-xl shadow-lg">
                    <div class="border-b border-gray-200">
                        <nav class="flex space-x-8 px-6">
                            <button onclick="showLaporanSubMenu('laporan-kategori')" class="laporan-nav-btn py-4 px-2 border-b-2 border-blue-500 text-blue-600 font-medium">
                                Laporan Kategori
                            </button>
                            <button onclick="showLaporanSubMenu('status-gudang')" class="laporan-nav-btn py-4 px-2 border-b-2 border-transparent text-gray-500 hover:text-gray-700 font-medium">
                                Status Barang di Gudang
                            </button>
                        </nav>
                    </div>

                    <!-- Laporan Kategori -->
                    <div id="laporan-kategori" class="laporan-sub-content p-6">
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <div class="bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl p-6">
                                <h2 class="text-xl font-bold text-gray-900 mb-4">Laporan Berdasarkan Kategori</h2>
                                <div class="space-y-4">
                                    <div>
                                        <label for="laporanKategori" class="block text-sm font-medium text-gray-700 mb-2">Pilih Kategori</label>
                                        <select id="laporanKategori" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                            <option value="semua">Semua Aset</option>
                                            <option value="tahun">Berdasarkan Tahun</option>
                                            <option value="sumber-dana">Berdasarkan Sumber Dana</option>
                                            <option value="kondisi">Berdasarkan Kondisi</option>
                                            <option value="lokasi">Berdasarkan Lokasi</option>
                                        </select>
                                    </div>
                                    <div id="filterTahun" class="hidden">
                                        <label for="tahunFilter" class="block text-sm font-medium text-gray-700 mb-2">Tahun</label>
                                        <input type="number" id="tahunFilter" min="1900" max="2099" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                    </div>
                                    <button onclick="generateLaporan()" class="w-full bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg font-medium transition-colors">
                                        Generate Laporan
                                    </button>
                                </div>
                            </div>
                            <div class="bg-gradient-to-br from-green-50 to-emerald-50 rounded-xl p-6">
                                <h2 class="text-xl font-bold text-gray-900 mb-4">Statistik Aset</h2>
                                <div id="statistikAset" class="space-y-4">
                                    <!-- Statistik akan diisi oleh JavaScript -->
                                </div>
                            </div>
                        </div>
                        <div class="mt-6 bg-white rounded-xl shadow-lg p-6">
                            <h3 class="text-lg font-bold text-gray-900 mb-4">Hasil Laporan</h3>
                            <div id="hasilLaporan" class="overflow-x-auto">
                                <p class="text-gray-500 text-center py-8">Pilih kategori dan klik "Generate Laporan" untuk melihat hasil</p>
                            </div>
                        </div>
                    </div>

                    <!-- Status Barang di Gudang -->
                    <div id="status-gudang" class="laporan-sub-content hidden p-6">
                        <div class="space-y-6">
                            <!-- Filter Section -->
                            <div class="bg-gradient-to-r from-purple-50 to-pink-50 rounded-xl p-6">
                                <h2 class="text-xl font-bold text-gray-900 mb-4 flex items-center">
                                    <div class="bg-purple-500 text-white rounded-full w-8 h-8 flex items-center justify-center mr-3">
                                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                                            <path d="M4 4a2 2 0 00-2 2v1h16V6a2 2 0 00-2-2H4zM18 9H2v5a2 2 0 002 2h12a2 2 0 002-2V9z"/>
                                        </svg>
                                    </div>
                                    Status Barang di Gudang
                                </h2>
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                                    <div>
                                        <label for="filterStatusGudang" class="block text-sm font-medium text-gray-700 mb-2">Filter Status</label>
                                        <select id="filterStatusGudang" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500">
                                            <option value="semua">Semua Status</option>
                                            <option value="tersedia">Tersedia di Gudang</option>
                                            <option value="sebagian">Sebagian Digunakan</option>
                                            <option value="digunakan">Sedang Digunakan (Habis)</option>
                                            <option value="rusak">Rusak/Perlu Perbaikan</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label for="filterKondisiGudang" class="block text-sm font-medium text-gray-700 mb-2">Filter Kondisi</label>
                                        <select id="filterKondisiGudang" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500">
                                            <option value="semua">Semua Kondisi</option>
                                            <option value="Baik">Baik</option>
                                            <option value="Rusak Ringan">Rusak Ringan</option>
                                            <option value="Rusak Berat">Rusak Berat</option>
                                            <option value="Perlu Perbaikan/Pemeliharaan">Perlu Perbaikan/Pemeliharaan</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label for="searchGudang" class="block text-sm font-medium text-gray-700 mb-2">Cari Barang</label>
                                        <input type="text" id="searchGudang" placeholder="Nama atau kode barang..." class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500">
                                    </div>
                                </div>
                                <button onclick="generateStatusGudang()" class="bg-purple-500 hover:bg-purple-600 text-white px-6 py-2 rounded-lg font-medium transition-colors">
                                    <svg class="w-4 h-4 inline mr-2" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd"/>
                                    </svg>
                                    Tampilkan Status Gudang
                                </button>
                            </div>

                            <!-- Summary Cards -->
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 xl:grid-cols-4 gap-4" id="summaryGudang">
                                <!-- Summary cards will be populated by JavaScript -->
                            </div>

                            <!-- Results Table -->
                            <div class="bg-white rounded-xl shadow-lg p-6">
                                <div class="flex justify-between items-center mb-4">
                                    <h3 class="text-lg font-bold text-gray-900">Detail Status Barang</h3>
                                    <div class="flex space-x-2">
                                        <button onclick="exportStatusGudang()" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors">
                                            <svg class="w-4 h-4 inline mr-1" fill="currentColor" viewBox="0 0 20 20">
                                                <path d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z"/>
                                            </svg>
                                            Export
                                        </button>
                                        <button onclick="printStatusGudang()" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors">
                                            <svg class="w-4 h-4 inline mr-1" fill="currentColor" viewBox="0 0 20 20">
                                                <path d="M5 4v3H4a2 2 0 00-2 2v3a2 2 0 002 2h1v2a2 2 0 002 2h6a2 2 0 002-2v-2h1a2 2 0 002-2V9a2 2 0 00-2-2h-1V4a2 2 0 00-2-2H7a2 2 0 00-2 2z"/>
                                            </svg>
                                            Cetak
                                        </button>
                                    </div>
                                </div>
                                <div id="hasilStatusGudang" class="overflow-x-auto">
                                    <p class="text-gray-500 text-center py-8">Klik "Tampilkan Status Gudang" untuk melihat data</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Kondisi Aset -->
            <div id="kondisi-aset" class="menu-content hidden">
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h2 class="text-xl font-bold text-gray-900 mb-6">Edit Kondisi Aset</h2>
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div>
                            <h3 class="text-lg font-semibold text-gray-900 mb-4">Cari Aset</h3>
                            <div class="space-y-4">
                                <div>
                                    <label for="cariKodeAset" class="block text-sm font-medium text-gray-700 mb-2">Kode Aset</label>
                                    <input type="text" id="cariKodeAset" placeholder="Masukkan kode aset" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                </div>
                                <div class="text-center text-gray-500">atau</div>
                                <div>
                                    <label for="cariNoRegistrasi" class="block text-sm font-medium text-gray-700 mb-2">Nomor Registrasi</label>
                                    <input type="text" id="cariNoRegistrasi" placeholder="Masukkan nomor registrasi" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                </div>
                                <button onclick="cariAsetKondisi()" class="w-full bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg font-medium transition-colors">
                                    Cari Aset
                                </button>
                            </div>
                        </div>
                        <div>
                            <h3 class="text-lg font-semibold text-gray-900 mb-4">Detail Aset</h3>
                            <div id="detailAsetKondisi" class="space-y-4">
                                <p class="text-gray-500 text-center py-8">Masukkan kode aset atau nomor registrasi untuk melihat detail</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tracking Barang -->
            <div id="tracking-barang" class="menu-content hidden">
                <div class="space-y-6">
                    <!-- Search Section -->
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h2 class="text-xl font-bold text-gray-900 mb-6">Tracking Barang</h2>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                            <div>
                                <label for="searchTrackingBarang" class="block text-sm font-medium text-gray-700 mb-2">Cari Barang</label>
                                <input type="text" id="searchTrackingBarang" placeholder="Nama barang atau kode..." class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            </div>
                            <div>
                                <label for="filterLokasi" class="block text-sm font-medium text-gray-700 mb-2">Filter Lokasi</label>
                                <select id="filterLokasi" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                    <option value="">Semua Lokasi</option>
                                </select>
                            </div>
                            <div>
                                <label for="filterPengguna" class="block text-sm font-medium text-gray-700 mb-2">Filter Pengguna</label>
                                <select id="filterPengguna" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                    <option value="">Semua Pengguna</option>
                                </select>
                            </div>
                        </div>
                        <button onclick="applyTrackingFilter()" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded-lg font-medium transition-colors">
                            Terapkan Filter
                        </button>
                    </div>

                    <!-- Tracking Results -->
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="text-lg font-bold text-gray-900">Hasil Tracking</h3>
                            <div class="flex space-x-3">
                                <button onclick="exportTrackingData()" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg font-medium transition-colors">
                                    Export Data
                                </button>
                                <button onclick="printTrackingData()" class="bg-purple-500 hover:bg-purple-600 text-white px-4 py-2 rounded-lg font-medium transition-colors">
                                    Cetak
                                </button>
                            </div>
                        </div>
                        <div id="trackingResults" class="overflow-x-auto">
                            <!-- Results will be populated by JavaScript -->
                        </div>
                    </div>

                    <!-- Summary Statistics -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="bg-gradient-to-r from-blue-500 to-blue-600 rounded-xl shadow-lg p-6 text-white">
                            <div class="flex items-center">
                                <div class="bg-blue-400 rounded-full p-3 mr-4">
                                    <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 20 20">
                                        <path d="M4 4a2 2 0 00-2 2v1h16V6a2 2 0 00-2-2H4zM18 9H2v5a2 2 0 002 2h12a2 2 0 002-2V9z"/>
                                    </svg>
                                </div>
                                <div>
                                    <p class="text-blue-100">Total Barang Terdistribusi</p>
                                    <p id="totalBarangTerdistribusi" class="text-2xl font-bold">0</p>
                                </div>
                            </div>
                        </div>
                        <div class="bg-gradient-to-r from-green-500 to-green-600 rounded-xl shadow-lg p-6 text-white">
                            <div class="flex items-center">
                                <div class="bg-green-400 rounded-full p-3 mr-4">
                                    <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd"/>
                                    </svg>
                                </div>
                                <div>
                                    <p class="text-green-100">Total Lokasi</p>
                                    <p id="totalLokasi" class="text-2xl font-bold">0</p>
                                </div>
                            </div>
                        </div>
                        <div class="bg-gradient-to-r from-purple-500 to-purple-600 rounded-xl shadow-lg p-6 text-white">
                            <div class="flex items-center">
                                <div class="bg-purple-400 rounded-full p-3 mr-4">
                                    <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 20 20">
                                        <path d="M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3z"/>
                                    </svg>
                                </div>
                                <div>
                                    <p class="text-purple-100">Total Pengguna Aktif</p>
                                    <p id="totalPenggunaAktif" class="text-2xl font-bold">0</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // Database dengan WiFi real-time sync
        class AssetDatabase {
            constructor() {
                this.assets = JSON.parse(localStorage.getItem('assets')) || [];
                this.users = JSON.parse(localStorage.getItem('assetUsers')) || [];
                this.conditions = JSON.parse(localStorage.getItem('assetConditions')) || {};
                this.isOnline = navigator.onLine;
                this.lastBackup = localStorage.getItem('lastBackup') || null;
                this.syncInterval = null;
                this.lastSyncTime = localStorage.getItem('lastSyncTime') || Date.now();
                this.connectedUsers = new Set();
                
                // WiFi Network Configuration
                this.networkConfig = {
                    serverPort: 3000,
                    broadcastPort: 3001,
                    networkName: 'ManajemenAset_Network',
                    syncEndpoint: '/api/sync',
                    isServer: false,
                    serverIP: null,
                    clientId: this.getUserId()
                };
                
                // Initialize WiFi-based real-time sync
                this.initializeWiFiSync();
                
                // Fallback ke localStorage sync jika WiFi tidak tersedia
                this.initializeLocalStorageSync();
                
                // Update status koneksi
                window.addEventListener('online', () => {
                    this.isOnline = true;
                    this.updateConnectionStatus();
                    this.startWiFiSync();
                });
                
                window.addEventListener('offline', () => {
                    this.isOnline = false;
                    this.updateConnectionStatus();
                    this.stopWiFiSync();
                });
                
                this.updateConnectionStatus();
                this.updateLastBackupDisplay();
                this.startWiFiSync();
            }
            
            initializeWiFiSync() {
                // Deteksi dan koneksi ke server WiFi
                this.discoverWiFiServer();
                
                // Setup WebSocket untuk real-time sync
                this.setupWebSocket();
                
                // Broadcast discovery untuk mencari server
                this.startServerDiscovery();
                
                // Initialize activity feed
                setTimeout(() => {
                    this.updateActivityFeed();
                    this.displayCurrentUserId();
                }, 100);
            }
            
            initializeLocalStorageSync() {
                // Fallback: localStorage events untuk sync lokal
                window.addEventListener('storage', (e) => {
                    if (e.key === 'assets' || e.key === 'assetUsers' || e.key === 'assetConditions' || e.key === 'activities') {
                        this.handleRemoteDataUpdate(e.key, e.newValue);
                    }
                });
                
                // Simulasi heartbeat untuk mendeteksi user aktif
                this.startHeartbeat();
            }
            
            async discoverWiFiServer() {
                try {
                    // Coba deteksi server di jaringan WiFi yang sama
                    const possibleIPs = await this.scanLocalNetwork();
                    
                    for (const ip of possibleIPs) {
                        try {
                            const response = await fetch(`http://${ip}:${this.networkConfig.serverPort}/api/ping`, {
                                method: 'GET',
                                timeout: 2000
                            });
                            
                            if (response.ok) {
                                const data = await response.json();
                                if (data.service === 'ManajemenAset') {
                                    this.networkConfig.serverIP = ip;
                                    this.networkConfig.isServer = false;
                                    this.showNetworkStatus(`Terhubung ke server: ${ip}`, 'success');
                                    return true;
                                }
                            }
                        } catch (e) {
                            // Server tidak ditemukan di IP ini
                            continue;
                        }
                    }
                    
                    // Jika tidak ada server, jadikan device ini sebagai server
                    this.becomeServer();
                    return false;
                    
                } catch (error) {
                    console.log('WiFi discovery failed, using localStorage sync');
                    this.showNetworkStatus('Mode offline - localStorage sync', 'warning');
                    return false;
                }
            }
            
            async scanLocalNetwork() {
                // Simulasi scan jaringan lokal
                // Dalam implementasi nyata, ini akan menggunakan WebRTC atau service discovery
                const baseIP = await this.getLocalIP();
                const ipParts = baseIP.split('.');
                const networkBase = `${ipParts[0]}.${ipParts[1]}.${ipParts[2]}`;
                
                const possibleIPs = [];
                for (let i = 1; i <= 254; i++) {
                    possibleIPs.push(`${networkBase}.${i}`);
                }
                
                return possibleIPs;
            }
            
            async getLocalIP() {
                // Simulasi mendapatkan IP lokal
                // Dalam implementasi nyata menggunakan WebRTC
                return new Promise((resolve) => {
                    const pc = new RTCPeerConnection({iceServers: []});
                    pc.createDataChannel('');
                    pc.createOffer().then(offer => pc.setLocalDescription(offer));
                    
                    pc.onicecandidate = (ice) => {
                        if (ice && ice.candidate && ice.candidate.candidate) {
                            const candidate = ice.candidate.candidate;
                            const match = candidate.match(/(\d+\.\d+\.\d+\.\d+)/);
                            if (match) {
                                pc.close();
                                resolve(match[1]);
                                return;
                            }
                        }
                    };
                    
                    // Fallback jika WebRTC gagal
                    setTimeout(() => {
                        pc.close();
                        resolve('192.168.1.100'); // Default IP
                    }, 3000);
                });
            }
            
            becomeServer() {
                this.networkConfig.isServer = true;
                this.networkConfig.serverIP = 'localhost';
                this.showNetworkStatus('Mode Server - Menunggu koneksi client', 'info');
                
                // Simulasi server HTTP untuk menerima koneksi
                this.startServerMode();
            }
            
            startServerMode() {
                // Simulasi server mode menggunakan localStorage sebagai message broker
                localStorage.setItem('network_server_info', JSON.stringify({
                    serverIP: this.networkConfig.serverIP,
                    port: this.networkConfig.serverPort,
                    timestamp: Date.now(),
                    serverId: this.networkConfig.clientId
                }));
                
                // Listen untuk client connections
                this.listenForClients();
            }
            
            listenForClients() {
                setInterval(() => {
                    // Check untuk client requests
                    const clientRequests = localStorage.getItem('network_client_requests');
                    if (clientRequests) {
                        try {
                            const requests = JSON.parse(clientRequests);
                            requests.forEach(request => {
                                if (request.timestamp > Date.now() - 10000) { // 10 detik terakhir
                                    this.handleClientRequest(request);
                                }
                            });
                        } catch (e) {
                            console.error('Error parsing client requests:', e);
                        }
                    }
                }, 1000);
            }
            
            handleClientRequest(request) {
                switch (request.type) {
                    case 'sync_request':
                        this.sendDataToClient(request.clientId);
                        break;
                    case 'data_update':
                        this.receiveDataFromClient(request.data, request.clientId);
                        break;
                }
            }
            
            sendDataToClient(clientId) {
                const syncData = {
                    assets: this.assets,
                    users: this.users,
                    conditions: this.conditions,
                    timestamp: Date.now(),
                    serverId: this.networkConfig.clientId
                };
                
                // Send via localStorage message system
                const responses = JSON.parse(localStorage.getItem('network_server_responses') || '[]');
                responses.push({
                    clientId: clientId,
                    data: syncData,
                    timestamp: Date.now(),
                    type: 'sync_response'
                });
                localStorage.setItem('network_server_responses', JSON.stringify(responses));
            }
            
            receiveDataFromClient(data, clientId) {
                // Merge data dari client
                this.mergeRemoteData(data);
                
                // Broadcast ke semua client lain
                this.broadcastToAllClients(data, clientId);
            }
            
            broadcastToAllClients(data, excludeClientId) {
                const broadcast = {
                    type: 'data_broadcast',
                    data: data,
                    timestamp: Date.now(),
                    fromClient: excludeClientId,
                    serverId: this.networkConfig.clientId
                };
                
                localStorage.setItem('network_broadcast', JSON.stringify(broadcast));
            }
            
            setupWebSocket() {
                // Simulasi WebSocket menggunakan localStorage events
                window.addEventListener('storage', (e) => {
                    if (e.key === 'network_broadcast') {
                        const broadcast = JSON.parse(e.newValue);
                        if (broadcast && broadcast.fromClient !== this.networkConfig.clientId) {
                            this.handleNetworkBroadcast(broadcast);
                        }
                    }
                    
                    if (e.key === 'network_server_responses') {
                        const responses = JSON.parse(e.newValue || '[]');
                        responses.forEach(response => {
                            if (response.clientId === this.networkConfig.clientId) {
                                this.handleServerResponse(response);
                            }
                        });
                    }
                });
            }
            
            handleNetworkBroadcast(broadcast) {
                if (broadcast.data) {
                    this.mergeRemoteData(broadcast.data);
                    this.showSyncNotification(`Data diperbarui dari ${broadcast.fromClient}`, 'info');
                }
            }
            
            handleServerResponse(response) {
                if (response.data) {
                    this.mergeRemoteData(response.data);
                    this.showSyncNotification('Data disinkronisasi dengan server', 'success');
                }
            }
            
            mergeRemoteData(remoteData) {
                let hasChanges = false;
                
                // Merge assets
                if (remoteData.assets && JSON.stringify(this.assets) !== JSON.stringify(remoteData.assets)) {
                    this.assets = this.mergeArrays(this.assets, remoteData.assets, 'id');
                    localStorage.setItem('assets', JSON.stringify(this.assets));
                    hasChanges = true;
                }
                
                // Merge users
                if (remoteData.users && JSON.stringify(this.users) !== JSON.stringify(remoteData.users)) {
                    this.users = this.mergeArrays(this.users, remoteData.users, 'id');
                    localStorage.setItem('assetUsers', JSON.stringify(this.users));
                    hasChanges = true;
                }
                
                // Merge conditions
                if (remoteData.conditions && JSON.stringify(this.conditions) !== JSON.stringify(remoteData.conditions)) {
                    this.conditions = { ...this.conditions, ...remoteData.conditions };
                    localStorage.setItem('assetConditions', JSON.stringify(this.conditions));
                    hasChanges = true;
                }
                
                if (hasChanges) {
                    this.refreshAllViews();
                }
            }
            
            mergeArrays(localArray, remoteArray, idField) {
                const merged = [...localArray];
                const localIds = new Set(localArray.map(item => item[idField]));
                
                remoteArray.forEach(remoteItem => {
                    if (!localIds.has(remoteItem[idField])) {
                        merged.push(remoteItem);
                    } else {
                        // Update existing item if remote is newer
                        const localIndex = merged.findIndex(item => item[idField] === remoteItem[idField]);
                        if (localIndex !== -1) {
                            const localItem = merged[localIndex];
                            const remoteTime = new Date(remoteItem.updatedAt || remoteItem.createdAt || 0);
                            const localTime = new Date(localItem.updatedAt || localItem.createdAt || 0);
                            
                            if (remoteTime > localTime) {
                                merged[localIndex] = remoteItem;
                            }
                        }
                    }
                });
                
                return merged;
            }
            
            startServerDiscovery() {
                // Broadcast discovery message setiap 30 detik
                setInterval(() => {
                    if (!this.networkConfig.isServer && !this.networkConfig.serverIP) {
                        this.discoverWiFiServer();
                    }
                }, 30000);
            }
            
            startWiFiSync() {
                if (this.syncInterval) return;
                
                this.syncInterval = setInterval(() => {
                    this.syncWithNetwork();
                }, 3000); // Sync setiap 3 detik
                
                this.showSyncStatus('WiFi sync aktif', 'success');
            }
            
            stopWiFiSync() {
                if (this.syncInterval) {
                    clearInterval(this.syncInterval);
                    this.syncInterval = null;
                }
                this.showSyncStatus('WiFi sync offline', 'warning');
            }
            
            async syncWithNetwork() {
                if (!this.isOnline) return;
                
                if (this.networkConfig.isServer) {
                    // Server mode: update heartbeat
                    localStorage.setItem('network_server_info', JSON.stringify({
                        serverIP: this.networkConfig.serverIP,
                        port: this.networkConfig.serverPort,
                        timestamp: Date.now(),
                        serverId: this.networkConfig.clientId
                    }));
                } else if (this.networkConfig.serverIP) {
                    // Client mode: request sync dari server
                    this.requestSyncFromServer();
                }
                
                this.lastSyncTime = Date.now();
                localStorage.setItem('lastSyncTime', this.lastSyncTime.toString());
                this.updateSyncTimeDisplay();
            }
            
            requestSyncFromServer() {
                const requests = JSON.parse(localStorage.getItem('network_client_requests') || '[]');
                requests.push({
                    type: 'sync_request',
                    clientId: this.networkConfig.clientId,
                    timestamp: Date.now()
                });
                localStorage.setItem('network_client_requests', JSON.stringify(requests));
            }
            
            showNetworkStatus(message, type) {
                console.log(`Network Status: ${message}`);
                
                // Update UI dengan status jaringan
                const statusEl = document.getElementById('networkStatus');
                if (statusEl) {
                    statusEl.textContent = message;
                    statusEl.className = `text-xs ${type === 'success' ? 'text-green-600' : type === 'warning' ? 'text-orange-600' : 'text-blue-600'}`;
                }
            }
            
            displayCurrentUserId() {
                const userIdEl = document.getElementById('currentUserId');
                if (userIdEl) {
                    userIdEl.textContent = this.getUserId();
                }
            }
            
            startRealTimeSync() {
                if (this.syncInterval) return;
                
                this.syncInterval = setInterval(() => {
                    this.syncWithServer();
                }, 2000); // Sync setiap 2 detik
                
                this.showSyncStatus('Sinkronisasi aktif', 'success');
            }
            
            stopRealTimeSync() {
                if (this.syncInterval) {
                    clearInterval(this.syncInterval);
                    this.syncInterval = null;
                }
                this.showSyncStatus('Sinkronisasi offline', 'warning');
            }
            
            startHeartbeat() {
                const userId = this.getUserId();
                
                setInterval(() => {
                    const heartbeat = {
                        userId: userId,
                        timestamp: Date.now(),
                        page: window.location.pathname
                    };
                    localStorage.setItem('userHeartbeat_' + userId, JSON.stringify(heartbeat));
                    this.updateConnectedUsers();
                }, 5000); // Heartbeat setiap 5 detik
            }
            
            getUserId() {
                let userId = localStorage.getItem('currentUserId');
                if (!userId) {
                    userId = 'user_' + Math.random().toString(36).substr(2, 9);
                    localStorage.setItem('currentUserId', userId);
                }
                return userId;
            }
            
            updateConnectedUsers() {
                const now = Date.now();
                const activeUsers = new Set();
                
                // Cek semua heartbeat dalam 15 detik terakhir
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    if (key && key.startsWith('userHeartbeat_')) {
                        try {
                            const heartbeat = JSON.parse(localStorage.getItem(key));
                            if (now - heartbeat.timestamp < 15000) { // 15 detik
                                activeUsers.add(heartbeat.userId);
                            } else {
                                localStorage.removeItem(key); // Cleanup old heartbeats
                            }
                        } catch (e) {
                            localStorage.removeItem(key);
                        }
                    }
                }
                
                this.connectedUsers = activeUsers;
                this.updateUserCountDisplay();
            }
            
            updateUserCountDisplay() {
                const userCountEl = document.getElementById('connectedUsers');
                if (userCountEl) {
                    userCountEl.textContent = this.connectedUsers.size;
                }
            }
            
            handleRemoteDataUpdate(key, newValue) {
                if (!newValue) return;
                
                try {
                    const newData = JSON.parse(newValue);
                    let updated = false;
                    
                    switch (key) {
                        case 'assets':
                            if (JSON.stringify(this.assets) !== newValue) {
                                this.assets = newData;
                                updated = true;
                                this.showSyncNotification('Data aset diperbarui oleh user lain', 'info');
                            }
                            break;
                        case 'assetUsers':
                            if (JSON.stringify(this.users) !== newValue) {
                                this.users = newData;
                                updated = true;
                                this.showSyncNotification('Data pengguna aset diperbarui', 'info');
                            }
                            break;
                        case 'assetConditions':
                            if (JSON.stringify(this.conditions) !== newValue) {
                                this.conditions = newData;
                                updated = true;
                                this.showSyncNotification('Kondisi aset diperbarui', 'info');
                            }
                            break;
                        case 'activities':
                            // Update activity feed when activities change
                            this.updateActivityFeed();
                            break;
                    }
                    
                    if (updated) {
                        this.refreshAllViews();
                    }
                } catch (e) {
                    console.error('Error parsing remote data:', e);
                }
            }
            
            refreshAllViews() {
                // Update semua tampilan yang mungkin terpengaruh
                updateDashboard();
                updateAssetTable();
                updateAssetDropdown();
                updateStatistics();
                
                // Update nomor urut untuk form baru
                generateNomorUrut();
            }
            
            syncWithServer() {
                if (!this.isOnline) return;
                
                // Simulasi sync dengan server
                const syncData = {
                    assets: this.assets,
                    users: this.users,
                    conditions: this.conditions,
                    timestamp: Date.now()
                };
                
                // Simulasi network delay
                setTimeout(() => {
                    this.lastSyncTime = Date.now();
                    localStorage.setItem('lastSyncTime', this.lastSyncTime.toString());
                    this.updateSyncTimeDisplay();
                }, Math.random() * 500 + 100);
            }
            
            updateSyncTimeDisplay() {
                const syncTimeEl = document.getElementById('lastSyncTime');
                if (syncTimeEl) {
                    const time = new Date(this.lastSyncTime).toLocaleTimeString('id-ID');
                    syncTimeEl.textContent = time;
                }
            }
            
            showSyncStatus(message, type) {
                const statusEl = document.getElementById('syncStatus');
                if (statusEl) {
                    statusEl.textContent = message;
                    statusEl.className = `text-sm font-medium ${type === 'success' ? 'text-green-600' : type === 'warning' ? 'text-orange-600' : 'text-blue-600'}`;
                }
            }
            
            showSyncNotification(message, type) {
                // Tampilkan notifikasi kecil di pojok kanan atas
                const notification = document.createElement('div');
                notification.className = `fixed top-20 right-4 z-50 px-4 py-2 rounded-lg shadow-lg text-white text-sm font-medium transform transition-all duration-300 ${
                    type === 'info' ? 'bg-blue-500' : type === 'success' ? 'bg-green-500' : 'bg-orange-500'
                }`;
                notification.innerHTML = `
                    <div class="flex items-center">
                        <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                        </svg>
                        ${message}
                    </div>
                `;
                
                document.body.appendChild(notification);
                
                // Animate in
                setTimeout(() => {
                    notification.style.transform = 'translateX(0)';
                }, 100);
                
                // Remove after 3 seconds
                setTimeout(() => {
                    notification.style.transform = 'translateX(100%)';
                    setTimeout(() => {
                        if (notification.parentNode) {
                            notification.parentNode.removeChild(notification);
                        }
                    }, 300);
                }, 3000);
            }
            
            updateConnectionStatus() {
                const statusEl = document.getElementById('dbStatus');
                if (this.isOnline) {
                    statusEl.textContent = 'Online ✓';
                    statusEl.className = 'text-sm font-semibold text-green-600';
                } else {
                    statusEl.textContent = 'Offline ⚠';
                    statusEl.className = 'text-sm font-semibold text-orange-600';
                }
            }
            
            updateLastBackupDisplay() {
                const lastBackupEl = document.getElementById('lastBackup');
                if (this.lastBackup) {
                    const date = new Date(this.lastBackup);
                    lastBackupEl.textContent = date.toLocaleString('id-ID');
                } else {
                    lastBackupEl.textContent = 'Belum ada';
                }
            }
            
            saveAsset(asset) {
                asset.id = Date.now().toString();
                asset.createdAt = new Date().toISOString();
                asset.updatedAt = new Date().toISOString();
                this.assets.push(asset);
                this.conditions[asset.id] = 'Baik'; // Default kondisi
                localStorage.setItem('assets', JSON.stringify(this.assets));
                localStorage.setItem('assetConditions', JSON.stringify(this.conditions));
                
                // Log activity
                this.logActivity('asset_created', {
                    assetName: asset.jenisBarang,
                    assetCode: asset.kodeBarang,
                    userId: this.getUserId()
                });
                
                // Sync ke jaringan WiFi
                this.syncToNetwork();
                return asset;
            }
            
            saveUser(user) {
                user.id = Date.now().toString();
                user.createdAt = new Date().toISOString();
                user.updatedAt = new Date().toISOString();
                this.users.push(user);
                localStorage.setItem('assetUsers', JSON.stringify(this.users));
                
                // Log activity
                this.logActivity('user_created', {
                    userName: user.namaPengguna,
                    assetName: user.namaBarangPengguna,
                    userId: this.getUserId()
                });
                
                // Sync ke jaringan WiFi
                this.syncToNetwork();
                return user;
            }
            
            updateCondition(assetId, condition, notes = '') {
                const asset = this.assets.find(a => a.id === assetId);
                this.conditions[assetId] = { condition, notes, updatedAt: new Date().toISOString() };
                localStorage.setItem('assetConditions', JSON.stringify(this.conditions));
                
                // Log activity
                this.logActivity('condition_updated', {
                    assetName: asset ? asset.jenisBarang : 'Unknown',
                    condition: condition,
                    userId: this.getUserId()
                });
                
                // Sync ke jaringan WiFi
                this.syncToNetwork();
            }
            
            syncToNetwork() {
                if (!this.isOnline) return;
                
                const syncData = {
                    assets: this.assets,
                    users: this.users,
                    conditions: this.conditions,
                    timestamp: Date.now(),
                    clientId: this.networkConfig.clientId
                };
                
                if (this.networkConfig.isServer) {
                    // Jika ini server, broadcast ke semua client
                    this.broadcastToAllClients(syncData, this.networkConfig.clientId);
                } else {
                    // Jika ini client, kirim update ke server
                    this.sendUpdateToServer(syncData);
                }
            }
            
            sendUpdateToServer(data) {
                const requests = JSON.parse(localStorage.getItem('network_client_requests') || '[]');
                requests.push({
                    type: 'data_update',
                    clientId: this.networkConfig.clientId,
                    data: data,
                    timestamp: Date.now()
                });
                localStorage.setItem('network_client_requests', JSON.stringify(requests));
            }
            
            logActivity(type, data) {
                const activity = {
                    id: Date.now().toString(),
                    type: type,
                    data: data,
                    timestamp: new Date().toISOString(),
                    userId: this.getUserId()
                };
                
                let activities = JSON.parse(localStorage.getItem('activities')) || [];
                activities.unshift(activity); // Add to beginning
                
                // Keep only last 50 activities
                if (activities.length > 50) {
                    activities = activities.slice(0, 50);
                }
                
                localStorage.setItem('activities', JSON.stringify(activities));
                this.updateActivityFeed();
            }
            
            updateActivityFeed() {
                const activities = JSON.parse(localStorage.getItem('activities')) || [];
                const feedEl = document.getElementById('activityFeed');
                
                if (!feedEl) return;
                
                if (activities.length === 0) {
                    feedEl.innerHTML = '<div class="text-sm text-gray-500 text-center py-4">Belum ada aktivitas</div>';
                    return;
                }
                
                const feedHTML = activities.slice(0, 10).map(activity => {
                    const time = new Date(activity.timestamp).toLocaleTimeString('id-ID', { 
                        hour: '2-digit', 
                        minute: '2-digit' 
                    });
                    const isCurrentUser = activity.userId === this.getUserId();
                    
                    let message = '';
                    let icon = '';
                    let color = 'text-gray-600';
                    
                    switch (activity.type) {
                        case 'asset_created':
                            message = `${isCurrentUser ? 'Anda' : 'User lain'} menambah aset "${activity.data.assetName}"`;
                            icon = '📦';
                            color = 'text-green-600';
                            break;
                        case 'user_created':
                            message = `${isCurrentUser ? 'Anda' : 'User lain'} menambah pengguna "${activity.data.userName}"`;
                            icon = '👤';
                            color = 'text-blue-600';
                            break;
                        case 'condition_updated':
                            message = `${isCurrentUser ? 'Anda' : 'User lain'} mengubah kondisi "${activity.data.assetName}" menjadi ${activity.data.condition}`;
                            icon = '🔧';
                            color = 'text-orange-600';
                            break;
                        default:
                            message = 'Aktivitas tidak dikenal';
                            icon = '❓';
                    }
                    
                    return `
                        <div class="flex items-start space-x-3 p-3 rounded-lg ${isCurrentUser ? 'bg-blue-50 border-l-2 border-blue-500' : 'bg-gray-50'}">
                            <div class="text-lg">${icon}</div>
                            <div class="flex-1 min-w-0">
                                <p class="text-sm ${color} font-medium">${message}</p>
                                <p class="text-xs text-gray-500 mt-1">${time}</p>
                            </div>
                        </div>
                    `;
                }).join('');
                
                feedEl.innerHTML = feedHTML;
            }
            
            syncToOnline() {
                if (this.isOnline) {
                    // Simulasi sync ke server online
                    console.log('Syncing to online database...');
                    // Di implementasi nyata, ini akan mengirim data ke server
                }
            }
            
            backup() {
                const backupData = {
                    assets: this.assets,
                    users: this.users,
                    conditions: this.conditions,
                    timestamp: new Date().toISOString()
                };
                
                const backupString = JSON.stringify(backupData, null, 2);
                const blob = new Blob([backupString], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                
                const timestamp = new Date().toISOString().replace(/[:.]/g, '-').split('T');
                const dateStr = timestamp[0];
                const timeStr = timestamp[1].split('.')[0];
                const filename = `ManajemenAset_Backup_${dateStr}_${timeStr}.json`;
                
                // Show backup location selection modal
                const modal = document.createElement('div');
                modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
                modal.innerHTML = `
                    <div class="bg-white rounded-xl p-6 max-w-lg mx-4 shadow-2xl">
                        <div class="text-center mb-6">
                            <div class="bg-blue-100 rounded-full w-16 h-16 flex items-center justify-center mx-auto mb-3">
                                <svg class="w-8 h-8 text-blue-600" fill="currentColor" viewBox="0 0 20 20">
                                    <path d="M3 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z"/>
                                </svg>
                            </div>
                            <h3 class="text-lg font-bold text-gray-900 mb-2">Pilih Lokasi Backup</h3>
                            <p class="text-sm text-gray-600 mb-4">Pilih tempat penyimpanan file backup Anda</p>
                            <div class="bg-blue-50 border border-blue-200 rounded-lg p-3 mb-4">
                                <p class="text-xs text-blue-600 mb-1">Nama file:</p>
                                <p class="font-mono text-sm text-blue-800 font-semibold">${filename}</p>
                            </div>
                        </div>
                        
                        <div class="space-y-3 mb-6">
                            <button onclick="downloadToLocation('recommended')" class="w-full bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white px-4 py-3 rounded-lg font-medium transition-all transform hover:scale-105 shadow-lg text-left">
                                <div class="flex items-center">
                                    <div class="bg-green-400 rounded-full p-2 mr-3">
                                        <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                            <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                        </svg>
                                    </div>
                                    <div>
                                        <p class="font-semibold">📁 D:/DB Manajemen Aset/ (Direkomendasikan)</p>
                                        <p class="text-xs text-green-100">Lokasi standar untuk backup sistem</p>
                                    </div>
                                </div>
                            </button>
                            
                            <button onclick="downloadToLocation('downloads')" class="w-full bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white px-4 py-3 rounded-lg font-medium transition-all transform hover:scale-105 shadow-lg text-left">
                                <div class="flex items-center">
                                    <div class="bg-blue-400 rounded-full p-2 mr-3">
                                        <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                            <path d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z"/>
                                        </svg>
                                    </div>
                                    <div>
                                        <p class="font-semibold">💾 Folder Downloads</p>
                                        <p class="text-xs text-blue-100">Simpan ke folder unduhan default</p>
                                    </div>
                                </div>
                            </button>
                            
                            <button onclick="downloadToLocation('custom')" class="w-full bg-gradient-to-r from-purple-500 to-purple-600 hover:from-purple-600 hover:to-purple-700 text-white px-4 py-3 rounded-lg font-medium transition-all transform hover:scale-105 shadow-lg text-left">
                                <div class="flex items-center">
                                    <div class="bg-purple-400 rounded-full p-2 mr-3">
                                        <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM6.293 6.707a1 1 0 010-1.414l3-3a1 1 0 011.414 0l3 3a1 1 0 01-1.414 1.414L11 5.414V13a1 1 0 11-2 0V5.414L7.707 6.707a1 1 0 01-1.414 0z" clip-rule="evenodd"/>
                                        </svg>
                                    </div>
                                    <div>
                                        <p class="font-semibold">🗂️ Pilih Lokasi Lain</p>
                                        <p class="text-xs text-purple-100">Browser akan menanyakan lokasi penyimpanan</p>
                                    </div>
                                </div>
                            </button>
                        </div>
                        
                        <div class="flex space-x-3">
                            <button onclick="this.parentElement.parentElement.parentElement.remove(); URL.revokeObjectURL('${url}')" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg font-medium transition-colors">
                                Batal
                            </button>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(modal);
                
                // Function to handle download based on location choice
                window.downloadToLocation = (locationType) => {
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = filename;
                    
                    let instructions = '';
                    
                    switch (locationType) {
                        case 'recommended':
                            instructions = `
                                <div class="bg-green-50 border border-green-200 rounded-lg p-4 mb-4">
                                    <p class="text-sm text-green-700 font-medium mb-2">📁 Instruksi Penyimpanan:</p>
                                    <ol class="text-xs text-green-600 space-y-1 list-decimal list-inside">
                                        <li>File akan diunduh ke folder Downloads</li>
                                        <li>Buat folder <span class="font-mono bg-green-100 px-1 rounded">D:/DB Manajemen Aset/</span> jika belum ada</li>
                                        <li>Pindahkan file dari Downloads ke <span class="font-mono bg-green-100 px-1 rounded">D:/DB Manajemen Aset/</span></li>
                                        <li>Pastikan file tersimpan dengan nama: <span class="font-mono bg-green-100 px-1 rounded">${filename}</span></li>
                                    </ol>
                                </div>
                            `;
                            break;
                        case 'downloads':
                            instructions = `
                                <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4">
                                    <p class="text-sm text-blue-700 font-medium mb-2">💾 File akan disimpan di:</p>
                                    <p class="text-xs text-blue-600">Folder Downloads dengan nama: <span class="font-mono bg-blue-100 px-1 rounded">${filename}</span></p>
                                </div>
                            `;
                            break;
                        case 'custom':
                            instructions = `
                                <div class="bg-purple-50 border border-purple-200 rounded-lg p-4 mb-4">
                                    <p class="text-sm text-purple-700 font-medium mb-2">🗂️ Pilih Lokasi:</p>
                                    <p class="text-xs text-purple-600">Browser akan menampilkan dialog untuk memilih lokasi penyimpanan file backup.</p>
                                </div>
                            `;
                            break;
                    }
                    
                    modal.remove();
                    
                    // Show download confirmation
                    const confirmModal = document.createElement('div');
                    confirmModal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
                    confirmModal.innerHTML = `
                        <div class="bg-white rounded-xl p-6 max-w-md mx-4 shadow-2xl">
                            <div class="text-center mb-4">
                                <div class="bg-orange-100 rounded-full w-16 h-16 flex items-center justify-center mx-auto mb-3">
                                    <svg class="w-8 h-8 text-orange-600" fill="currentColor" viewBox="0 0 20 20">
                                        <path d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z"/>
                                    </svg>
                                </div>
                                <h3 class="text-lg font-bold text-gray-900 mb-2">Konfirmasi Download</h3>
                                ${instructions}
                            </div>
                            <div class="flex space-x-3">
                                <button onclick="this.parentElement.parentElement.parentElement.remove(); URL.revokeObjectURL('${url}')" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg font-medium transition-colors">
                                    Batal
                                </button>
                                <button onclick="executeDownload()" class="flex-1 bg-orange-500 hover:bg-orange-600 text-white px-4 py-2 rounded-lg font-medium transition-colors">
                                    Mulai Download
                                </button>
                            </div>
                        </div>
                    `;
                    
                    document.body.appendChild(confirmModal);
                    
                    // Execute download function
                    window.executeDownload = () => {
                        document.body.appendChild(a);
                        a.click();
                        document.body.removeChild(a);
                        URL.revokeObjectURL(url);
                        confirmModal.remove();
                        
                        this.lastBackup = new Date().toISOString();
                        localStorage.setItem('lastBackup', this.lastBackup);
                        this.updateLastBackupDisplay();
                        
                        // Show success message
                        setTimeout(() => {
                            this.showBackupSuccess(filename, locationType);
                        }, 500);
                    };
                };
                
                return true;
            }
            
            showBackupSuccess(filename, locationType = 'recommended') {
                let locationMessage = '';
                let locationColor = 'green';
                
                switch (locationType) {
                    case 'recommended':
                        locationMessage = `
                            <div class="bg-green-50 border border-green-200 rounded-lg p-3 mb-4">
                                <p class="text-sm text-green-700 font-medium mb-1">📁 Langkah Selanjutnya:</p>
                                <p class="text-xs text-green-600">Pindahkan file dari Downloads ke: <span class="font-mono bg-green-100 px-1 rounded">D:/DB Manajemen Aset/</span></p>
                                <p class="text-xs text-green-600 mt-1">File: <span class="font-mono">${filename}</span></p>
                            </div>
                        `;
                        break;
                    case 'downloads':
                        locationMessage = `
                            <div class="bg-blue-50 border border-blue-200 rounded-lg p-3 mb-4">
                                <p class="text-sm text-blue-700 font-medium mb-1">💾 File Tersimpan di:</p>
                                <p class="text-xs text-blue-600">Folder Downloads: <span class="font-mono bg-blue-100 px-1 rounded">${filename}</span></p>
                            </div>
                        `;
                        locationColor = 'blue';
                        break;
                    case 'custom':
                        locationMessage = `
                            <div class="bg-purple-50 border border-purple-200 rounded-lg p-3 mb-4">
                                <p class="text-sm text-purple-700 font-medium mb-1">🗂️ File Tersimpan:</p>
                                <p class="text-xs text-purple-600">Lokasi yang Anda pilih: <span class="font-mono bg-purple-100 px-1 rounded">${filename}</span></p>
                            </div>
                        `;
                        locationColor = 'purple';
                        break;
                }
                
                const successModal = document.createElement('div');
                successModal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
                successModal.innerHTML = `
                    <div class="bg-white rounded-xl p-6 max-w-md mx-4 shadow-2xl">
                        <div class="text-center">
                            <div class="bg-${locationColor}-100 rounded-full w-16 h-16 flex items-center justify-center mx-auto mb-3">
                                <svg class="w-8 h-8 text-${locationColor}-600" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                                </svg>
                            </div>
                            <h3 class="text-lg font-bold text-${locationColor}-900 mb-2">Backup Berhasil!</h3>
                            <p class="text-sm text-gray-600 mb-4">File backup telah berhasil diunduh</p>
                            ${locationMessage}
                            <div class="bg-gray-50 border border-gray-200 rounded-lg p-3 mb-4">
                                <p class="text-xs text-gray-600">
                                    <span class="font-medium">Waktu Backup:</span> ${new Date().toLocaleString('id-ID')}<br>
                                    <span class="font-medium">Total Data:</span> ${this.assets.length} Aset, ${this.users.length} Pengguna
                                </p>
                            </div>
                            <button onclick="this.parentElement.parentElement.parentElement.remove()" class="w-full bg-${locationColor}-500 hover:bg-${locationColor}-600 text-white px-4 py-2 rounded-lg font-medium transition-colors">
                                OK, Selesai
                            </button>
                        </div>
                    </div>
                `;
                document.body.appendChild(successModal);
                
                // Auto close after 7 seconds
                setTimeout(() => {
                    if (successModal.parentNode) {
                        successModal.remove();
                    }
                }, 7000);
            }
            
            restore(backupData) {
                try {
                    this.assets = backupData.assets || [];
                    this.users = backupData.users || [];
                    this.conditions = backupData.conditions || {};
                    
                    localStorage.setItem('assets', JSON.stringify(this.assets));
                    localStorage.setItem('assetUsers', JSON.stringify(this.users));
                    localStorage.setItem('assetConditions', JSON.stringify(this.conditions));
                    
                    return true;
                } catch (error) {
                    console.error('Error restoring backup:', error);
                    return false;
                }
            }
        }
        
        // Initialize database
        const db = new AssetDatabase();
        
        // Navigation functions
        function showMenu(menuId) {
            // Hide all menu contents
            document.querySelectorAll('.menu-content').forEach(el => {
                el.classList.add('hidden');
            });
            
            // Show selected menu
            document.getElementById(menuId).classList.remove('hidden');
            document.getElementById(menuId).classList.add('fade-in');
            
            // Update navigation buttons
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('border-blue-500', 'text-blue-600');
                btn.classList.add('border-transparent', 'text-gray-500');
            });
            
            event.target.classList.remove('border-transparent', 'text-gray-500');
            event.target.classList.add('border-blue-500', 'text-blue-600');
            
            // Update data when showing specific menus
            if (menuId === 'beranda') {
                updateDashboard();
            } else if (menuId === 'rekap-aset') {
                updateAssetTable();
            } else if (menuId === 'laporan') {
                updateStatistics();
            } else if (menuId === 'entri-data') {
                updateAssetDropdown();
            } else if (menuId === 'tracking-barang') {
                updateTrackingData();
            }
        }
        
        function showSubMenu(subMenuId) {
            // Hide all sub-menu contents
            document.querySelectorAll('.sub-menu-content').forEach(el => {
                el.classList.add('hidden');
            });
            
            // Show selected sub-menu
            document.getElementById(subMenuId).classList.remove('hidden');
            
            // Update sub-navigation buttons
            document.querySelectorAll('.sub-nav-btn').forEach(btn => {
                btn.classList.remove('border-blue-500', 'text-blue-600');
                btn.classList.add('border-transparent', 'text-gray-500');
            });
            
            event.target.classList.remove('border-transparent', 'text-gray-500');
            event.target.classList.add('border-blue-500', 'text-blue-600');
        }
        
        // Auto-calculate total price
        function calculateTotal() {
            const jumlah = parseInt(document.getElementById('jumlah').value) || 0;
            const hargaSatuan = parseInt(document.getElementById('hargaSatuan').value) || 0;
            const total = jumlah * hargaSatuan;
            document.getElementById('totalHarga').value = total > 0 ? 'Rp ' + total.toLocaleString('id-ID') : '';
        }
        
        // Auto-generate nomor urut
        function generateNomorUrut() {
            const nextNumber = db.assets.length + 1;
            document.getElementById('nomorUrut').value = nextNumber.toString().padStart(3, '0');
        }
        
        // Add event listeners for auto-calculation
        document.getElementById('jumlah').addEventListener('input', calculateTotal);
        document.getElementById('hargaSatuan').addEventListener('input', calculateTotal);
        
        // Form handling
        document.getElementById('asetForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const asset = {};
            
            for (let [key, value] of formData.entries()) {
                asset[key] = value;
            }
            
            // Add calculated total
            const jumlah = parseInt(asset.jumlah) || 0;
            const hargaSatuan = parseInt(asset.hargaSatuan) || 0;
            asset.totalHarga = jumlah * hargaSatuan;
            
            db.saveAsset(asset);
            showToast('Data aset berhasil disimpan!', 'success');
            this.reset();
            generateNomorUrut(); // Generate new number for next entry
            updateDashboard();
            updateAssetDropdown();
        });
        
        document.getElementById('penggunaForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const user = {};
            
            for (let [key, value] of formData.entries()) {
                user[key] = value;
            }
            
            db.saveUser(user);
            showToast('Data pengguna aset berhasil disimpan!', 'success');
            this.reset();
            updateDashboard();
        });
        
        // Asset dropdown update for user form
        document.getElementById('namaBarangPengguna').addEventListener('change', function() {
            const selectedAsset = db.assets.find(asset => (asset.jenisBarang || asset.namaBarang) === this.value);
            if (selectedAsset) {
                document.getElementById('kodeBarangPengguna').value = selectedAsset.kodeBarang || '';
                document.getElementById('nomorRegisterPengguna').value = selectedAsset.nomorRegistrasi || selectedAsset.nomorUrut || '';
            }
        });
        
        // Utility functions
        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.remove();
            }, 3000);
        }
        
        function resetForm(formId) {
            document.getElementById(formId).reset();
            showToast('Form berhasil direset', 'info');
        }
        
        function updateDashboard() {
            document.getElementById('totalAset').textContent = db.assets.length;
            document.getElementById('asetAktif').textContent = db.assets.filter(asset => {
                const condition = db.conditions[asset.id];
                return typeof condition === 'object' ? condition.condition === 'Baik' : condition === 'Baik';
            }).length;
            document.getElementById('asetPerawatan').textContent = db.assets.filter(asset => {
                const condition = db.conditions[asset.id];
                const conditionValue = typeof condition === 'object' ? condition.condition : condition;
                return conditionValue === 'Rusak Ringan' || conditionValue === 'Rusak Berat' || conditionValue === 'Perlu Perbaikan/Pemeliharaan';
            }).length;
            document.getElementById('totalPengguna').textContent = db.users.length;
        }
        
        function updateAssetDropdown() {
            const dropdown = document.getElementById('namaBarangPengguna');
            dropdown.innerHTML = '<option value="">Pilih Barang</option>';
            
            db.assets.forEach(asset => {
                const option = document.createElement('option');
                option.value = asset.jenisBarang || asset.namaBarang;
                option.textContent = asset.jenisBarang || asset.namaBarang;
                dropdown.appendChild(option);
            });
        }
        
        function updateAssetTable() {
            const tbody = document.getElementById('asetTableBody');
            tbody.innerHTML = '';
            
            db.assets.forEach((asset, index) => {
                const condition = db.conditions[asset.id];
                const conditionValue = typeof condition === 'object' ? condition.condition : (condition || 'Baik');
                
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50 transition-colors';
                row.innerHTML = `
                    <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-900 font-medium">${asset.nomorUrut || (index + 1).toString().padStart(3, '0')}</td>
                    <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-900">${asset.jenisBarang || '-'}</td>
                    <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-900 font-mono">${asset.kodeBarang || '-'}</td>
                    <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-900">${asset.bast || '-'}</td>
                    <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-900">${asset.tanggalBast || '-'}</td>
                    <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-900">${asset.sp2d || '-'}</td>
                    <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-900">${asset.tanggalSp2d || '-'}</td>
                    <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-900">${asset.merkType || '-'}</td>
                    <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-900">${asset.ukuranCc || '-'}</td>
                    <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-900">${asset.bahan || '-'}</td>
                    <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-900">${asset.tahunPembelian || '-'}</td>
                    <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-900">${asset.namaPabrik || '-'}</td>
                    <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-900 font-mono">${asset.nomorRangka || '-'}</td>
                    <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-900 font-mono">${asset.nomorMesin || '-'}</td>
                    <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-900 font-mono">${asset.nomorPolisi || '-'}</td>
                    <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-900 font-mono">${asset.nomorBpkb || '-'}</td>
                    <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-900">${asset.sumberPerolehan || '-'}</td>
                    <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-900 text-center">${asset.jumlah || '-'}</td>
                    <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-900">${asset.biayaUmum ? 'Rp ' + parseInt(asset.biayaUmum).toLocaleString('id-ID') : '-'}</td>
                    <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-900">${asset.hargaSatuan ? 'Rp ' + parseInt(asset.hargaSatuan).toLocaleString('id-ID') : '-'}</td>
                    <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-900 font-semibold">${asset.totalHarga ? 'Rp ' + parseInt(asset.totalHarga).toLocaleString('id-ID') : '-'}</td>
                    <td class="px-4 py-3 text-sm text-gray-900 max-w-xs truncate" title="${asset.keterangan || ''}">${asset.keterangan || '-'}</td>
                    <td class="px-4 py-3 whitespace-nowrap">
                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${getConditionColor(conditionValue)}">
                            ${conditionValue}
                        </span>
                    </td>
                    <td class="px-4 py-3 whitespace-nowrap text-sm font-medium">
                        <button onclick="editAsset('${asset.id}')" class="text-blue-600 hover:text-blue-900 mr-2 px-2 py-1 rounded hover:bg-blue-50">Edit</button>
                        <button onclick="deleteAsset('${asset.id}')" class="text-red-600 hover:text-red-900 px-2 py-1 rounded hover:bg-red-50">Hapus</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        
        function getConditionColor(condition) {
            switch (condition) {
                case 'Baik': return 'bg-green-100 text-green-800';
                case 'Rusak Ringan': return 'bg-yellow-100 text-yellow-800';
                case 'Rusak Berat': return 'bg-red-100 text-red-800';
                case 'Perlu Perbaikan/Pemeliharaan': return 'bg-orange-100 text-orange-800';
                default: return 'bg-gray-100 text-gray-800';
            }
        }
        
        function editAsset(assetId) {
            showToast('Fitur edit akan segera tersedia', 'info');
        }
        
        function deleteAsset(assetId) {
            if (confirm('Apakah Anda yakin ingin menghapus aset ini?')) {
                db.assets = db.assets.filter(asset => asset.id !== assetId);
                delete db.conditions[assetId];
                localStorage.setItem('assets', JSON.stringify(db.assets));
                localStorage.setItem('assetConditions', JSON.stringify(db.conditions));
                updateAssetTable();
                updateDashboard();
                showToast('Aset berhasil dihapus', 'success');
            }
        }
        
        // Search functionality
        document.getElementById('searchAset').addEventListener('input', function() {
            const searchTerm = this.value.toLowerCase();
            const rows = document.querySelectorAll('#asetTableBody tr');
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        });
        
        // Backup and restore functions
        function backupToGoogleDrive() {
            if (db.backup()) {
                showToast('Backup berhasil dibuat dan diunduh!', 'success');
            } else {
                showToast('Gagal membuat backup', 'error');
            }
        }
        
        function restoreFromBackup() {
            // Show modal dengan instruksi untuk mengambil file dari direktori khusus
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white rounded-xl p-6 max-w-md mx-4 shadow-2xl">
                    <div class="text-center mb-4">
                        <div class="bg-orange-100 rounded-full w-16 h-16 flex items-center justify-center mx-auto mb-3">
                            <svg class="w-8 h-8 text-orange-600" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M3 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z"/>
                            </svg>
                        </div>
                        <h3 class="text-lg font-bold text-gray-900 mb-2">Ambil Data Backup</h3>
                        <p class="text-sm text-gray-600 mb-4">Pilih file backup dari direktori:</p>
                        <div class="bg-orange-50 border border-orange-200 rounded-lg p-3 mb-4">
                            <p class="font-mono text-sm text-orange-700 font-semibold">D:/DB Manajemen Aset/</p>
                        </div>
                        <p class="text-xs text-gray-500 mb-4">Cari file dengan nama: <span class="font-mono">ManajemenAset_Backup_*.json</span></p>
                    </div>
                    <div class="flex space-x-3">
                        <button onclick="this.parentElement.parentElement.parentElement.remove()" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg font-medium transition-colors">
                            Batal
                        </button>
                        <button id="selectBackupFile" class="flex-1 bg-orange-500 hover:bg-orange-600 text-white px-4 py-2 rounded-lg font-medium transition-colors">
                            Pilih File Backup
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Event untuk tombol pilih file
            document.getElementById('selectBackupFile').onclick = () => {
                modal.remove();
                
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = '.json';
                input.onchange = function(e) {
                    const file = e.target.files[0];
                    if (file) {
                        // Validasi nama file
                        if (!file.name.includes('ManajemenAset_Backup_') || !file.name.endsWith('.json')) {
                            showRestoreError('File yang dipilih bukan file backup yang valid. Pastikan memilih file dengan nama "ManajemenAset_Backup_*.json"');
                            return;
                        }
                        
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            try {
                                const backupData = JSON.parse(e.target.result);
                                
                                // Validasi struktur data backup
                                if (!backupData.assets || !backupData.users || !backupData.conditions) {
                                    showRestoreError('File backup tidak memiliki struktur data yang valid');
                                    return;
                                }
                                
                                // Konfirmasi restore
                                showRestoreConfirmation(backupData, file.name);
                                
                            } catch (error) {
                                showRestoreError('File backup rusak atau tidak dapat dibaca');
                            }
                        };
                        reader.readAsText(file);
                    }
                };
                input.click();
            };
        }
        
        function showRestoreConfirmation(backupData, filename) {
            const confirmModal = document.createElement('div');
            confirmModal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            confirmModal.innerHTML = `
                <div class="bg-white rounded-xl p-6 max-w-lg mx-4 shadow-2xl">
                    <div class="text-center mb-4">
                        <div class="bg-yellow-100 rounded-full w-16 h-16 flex items-center justify-center mx-auto mb-3">
                            <svg class="w-8 h-8 text-yellow-600" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92z" clip-rule="evenodd"/>
                            </svg>
                        </div>
                        <h3 class="text-lg font-bold text-gray-900 mb-2">Konfirmasi Restore Data</h3>
                        <p class="text-sm text-gray-600 mb-4">Data saat ini akan diganti dengan data backup:</p>
                        
                        <div class="bg-gray-50 rounded-lg p-4 mb-4 text-left">
                            <p class="text-xs text-gray-500 mb-2">File: <span class="font-mono">${filename}</span></p>
                            <div class="grid grid-cols-2 gap-4 text-sm">
                                <div>
                                    <p class="font-medium text-gray-700">Data Backup:</p>
                                    <p class="text-gray-600">• ${backupData.assets.length} Aset</p>
                                    <p class="text-gray-600">• ${backupData.users.length} Pengguna</p>
                                    <p class="text-gray-600">• ${Object.keys(backupData.conditions).length} Kondisi</p>
                                </div>
                                <div>
                                    <p class="font-medium text-gray-700">Data Saat Ini:</p>
                                    <p class="text-gray-600">• ${db.assets.length} Aset</p>
                                    <p class="text-gray-600">• ${db.users.length} Pengguna</p>
                                    <p class="text-gray-600">• ${Object.keys(db.conditions).length} Kondisi</p>
                                </div>
                            </div>
                            <p class="text-xs text-gray-500 mt-2">Tanggal Backup: ${new Date(backupData.timestamp).toLocaleString('id-ID')}</p>
                        </div>
                        
                        <div class="bg-red-50 border border-red-200 rounded-lg p-3 mb-4">
                            <p class="text-sm text-red-700 font-medium">⚠️ Peringatan:</p>
                            <p class="text-xs text-red-600">Semua data saat ini akan hilang dan diganti dengan data backup!</p>
                        </div>
                    </div>
                    <div class="flex space-x-3">
                        <button onclick="this.parentElement.parentElement.parentElement.remove()" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg font-medium transition-colors">
                            Batal
                        </button>
                        <button onclick="executeRestore(arguments[0], arguments[1]); this.parentElement.parentElement.parentElement.remove();" class="flex-1 bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg font-medium transition-colors">
                            Ya, Restore Data
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(confirmModal);
            
            // Set event untuk tombol restore
            const restoreBtn = confirmModal.querySelector('button:last-child');
            restoreBtn.onclick = () => {
                executeRestore(backupData, filename);
                confirmModal.remove();
            };
        }
        
        function executeRestore(backupData, filename) {
            if (db.restore(backupData)) {
                showRestoreSuccess(filename, backupData);
                updateDashboard();
                updateAssetTable();
                updateAssetDropdown();
                updateStatistics();
            } else {
                showRestoreError('Gagal memulihkan data dari backup');
            }
        }
        
        function showRestoreSuccess(filename, backupData) {
            const successModal = document.createElement('div');
            successModal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            successModal.innerHTML = `
                <div class="bg-white rounded-xl p-6 max-w-md mx-4 shadow-2xl">
                    <div class="text-center">
                        <div class="bg-green-100 rounded-full w-16 h-16 flex items-center justify-center mx-auto mb-3">
                            <svg class="w-8 h-8 text-green-600" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                            </svg>
                        </div>
                        <h3 class="text-lg font-bold text-green-900 mb-2">Restore Berhasil!</h3>
                        <p class="text-sm text-gray-600 mb-4">Data berhasil dipulihkan dari backup:</p>
                        <div class="bg-green-50 border border-green-200 rounded-lg p-3 mb-4">
                            <p class="text-xs text-green-600 mb-2">${filename}</p>
                            <div class="text-sm text-green-700">
                                <p>✓ ${backupData.assets.length} Aset dipulihkan</p>
                                <p>✓ ${backupData.users.length} Pengguna dipulihkan</p>
                                <p>✓ ${Object.keys(backupData.conditions).length} Kondisi dipulihkan</p>
                            </div>
                        </div>
                        <button onclick="this.parentElement.parentElement.parentElement.remove()" class="w-full bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg font-medium transition-colors">
                            OK, Selesai
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(successModal);
            
            // Auto close after 5 seconds
            setTimeout(() => {
                if (successModal.parentNode) {
                    successModal.remove();
                }
            }, 5000);
        }
        
        function showRestoreError(message) {
            const errorModal = document.createElement('div');
            errorModal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            errorModal.innerHTML = `
                <div class="bg-white rounded-xl p-6 max-w-md mx-4 shadow-2xl">
                    <div class="text-center">
                        <div class="bg-red-100 rounded-full w-16 h-16 flex items-center justify-center mx-auto mb-3">
                            <svg class="w-8 h-8 text-red-600" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
                            </svg>
                        </div>
                        <h3 class="text-lg font-bold text-red-900 mb-2">Restore Gagal</h3>
                        <p class="text-sm text-gray-600 mb-4">${message}</p>
                        <div class="bg-red-50 border border-red-200 rounded-lg p-3 mb-4">
                            <p class="text-xs text-red-600">Pastikan file backup berada di: <span class="font-mono">D:/DB Manajemen Aset/</span></p>
                        </div>
                        <button onclick="this.parentElement.parentElement.parentElement.remove()" class="w-full bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg font-medium transition-colors">
                            OK, Mengerti
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(errorModal);
        }
        
        // Asset condition search
        function cariAsetKondisi() {
            const kodeAset = document.getElementById('cariKodeAset').value;
            const noRegistrasi = document.getElementById('cariNoRegistrasi').value;
            
            let asset = null;
            
            if (kodeAset) {
                asset = db.assets.find(a => a.kodeBarang === kodeAset);
            } else if (noRegistrasi) {
                asset = db.assets.find(a => a.nomorRegistrasi === noRegistrasi);
            }
            
            const detailDiv = document.getElementById('detailAsetKondisi');
            
            if (asset) {
                const condition = db.conditions[asset.id];
                const conditionValue = typeof condition === 'object' ? condition.condition : (condition || 'Baik');
                const notes = typeof condition === 'object' ? condition.notes : '';
                
                detailDiv.innerHTML = `
                    <div class="border rounded-lg p-4">
                        <h4 class="font-semibold text-gray-900 mb-3">${asset.namaBarang}</h4>
                        <div class="grid grid-cols-2 gap-4 text-sm">
                            <div><span class="font-medium">Kode:</span> ${asset.kodeBarang}</div>
                            <div><span class="font-medium">No. Registrasi:</span> ${asset.nomorRegistrasi}</div>
                            <div><span class="font-medium">Merk/Type:</span> ${asset.merk}/${asset.type}</div>
                            <div><span class="font-medium">Tahun:</span> ${asset.tahunPengadaan}</div>
                        </div>
                        <div class="mt-4">
                            <label for="kondisiAset" class="block text-sm font-medium text-gray-700 mb-2">Kondisi Aset</label>
                            <select id="kondisiAset" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                <option value="Baik" ${conditionValue === 'Baik' ? 'selected' : ''}>Baik</option>
                                <option value="Rusak Ringan" ${conditionValue === 'Rusak Ringan' ? 'selected' : ''}>Rusak Ringan</option>
                                <option value="Rusak Berat" ${conditionValue === 'Rusak Berat' ? 'selected' : ''}>Rusak Berat</option>
                                <option value="Perlu Perbaikan/Pemeliharaan" ${conditionValue === 'Perlu Perbaikan/Pemeliharaan' ? 'selected' : ''}>Perlu Perbaikan/Pemeliharaan</option>
                            </select>
                        </div>
                        <div class="mt-4">
                            <label for="catatanKondisi" class="block text-sm font-medium text-gray-700 mb-2">Catatan</label>
                            <textarea id="catatanKondisi" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="Tambahkan catatan kondisi...">${notes}</textarea>
                        </div>
                        <button onclick="updateKondisiAset('${asset.id}')" class="mt-4 bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg font-medium transition-colors">
                            Update Kondisi
                        </button>
                    </div>
                `;
            } else {
                detailDiv.innerHTML = '<p class="text-red-500 text-center py-8">Aset tidak ditemukan</p>';
            }
        }
        
        function updateKondisiAset(assetId) {
            const kondisi = document.getElementById('kondisiAset').value;
            const catatan = document.getElementById('catatanKondisi').value;
            
            db.updateCondition(assetId, kondisi, catatan);
            showToast('Kondisi aset berhasil diupdate!', 'success');
            updateDashboard();
            updateAssetTable();
        }
        
        // Report functions
        document.getElementById('laporanKategori').addEventListener('change', function() {
            const filterDiv = document.getElementById('filterTahun');
            if (this.value === 'tahun') {
                filterDiv.classList.remove('hidden');
            } else {
                filterDiv.classList.add('hidden');
            }
        });
        
        function generateLaporan() {
            const kategori = document.getElementById('laporanKategori').value;
            const tahunFilter = document.getElementById('tahunFilter').value;
            const hasilDiv = document.getElementById('hasilLaporan');
            
            let filteredAssets = [...db.assets];
            let reportTitle = 'Laporan Semua Aset';
            
            switch (kategori) {
                case 'tahun':
                    if (tahunFilter) {
                        filteredAssets = filteredAssets.filter(asset => asset.tahunPembelian == tahunFilter);
                        reportTitle = `Laporan Aset Tahun ${tahunFilter}`;
                    }
                    break;
                case 'sumber-dana':
                    reportTitle = 'Laporan Berdasarkan Sumber Perolehan';
                    break;
                case 'kondisi':
                    reportTitle = 'Laporan Berdasarkan Kondisi Aset';
                    break;
                case 'lokasi':
                    reportTitle = 'Laporan Berdasarkan Lokasi Pengguna';
                    break;
            }
            
            if (filteredAssets.length === 0) {
                hasilDiv.innerHTML = '<p class="text-gray-500 text-center py-8">Tidak ada data yang sesuai dengan filter</p>';
                return;
            }
            
            let tableHTML = `
                <div class="mb-4">
                    <h3 class="text-lg font-bold text-gray-900">${reportTitle}</h3>
                    <p class="text-sm text-gray-600">Tanggal: ${new Date().toLocaleDateString('id-ID')}</p>
                </div>
                <table class="min-w-full divide-y divide-gray-200 border border-gray-300">
                    <thead class="bg-gradient-to-r from-blue-50 to-indigo-50">
                        <tr>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider border-r">No</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider border-r">Jenis Barang</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider border-r">Kode Barang</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider border-r">Merk/Type</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider border-r">Tahun</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider border-r">Sumber Perolehan</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider border-r">Jumlah</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider border-r">Harga Satuan</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider border-r">Total Harga</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">Kondisi</th>
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200">
            `;
            
            let totalNilai = 0;
            let totalJumlah = 0;
            
            filteredAssets.forEach((asset, index) => {
                const condition = db.conditions[asset.id];
                const conditionValue = typeof condition === 'object' ? condition.condition : (condition || 'Baik');
                const hargaSatuan = parseInt(asset.hargaSatuan) || 0;
                const jumlah = parseInt(asset.jumlah) || 0;
                const totalHarga = parseInt(asset.totalHarga) || (hargaSatuan * jumlah);
                
                totalNilai += totalHarga;
                totalJumlah += jumlah;
                
                tableHTML += `
                    <tr class="hover:bg-gray-50">
                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-900 border-r">${asset.nomorUrut || (index + 1).toString().padStart(3, '0')}</td>
                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-900 border-r">${asset.jenisBarang || '-'}</td>
                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-900 font-mono border-r">${asset.kodeBarang || '-'}</td>
                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-900 border-r">${asset.merkType || '-'}</td>
                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-900 border-r">${asset.tahunPembelian || '-'}</td>
                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-900 border-r">${asset.sumberPerolehan || '-'}</td>
                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-900 text-center border-r">${jumlah}</td>
                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-900 border-r">${hargaSatuan > 0 ? 'Rp ' + hargaSatuan.toLocaleString('id-ID') : '-'}</td>
                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-900 font-semibold border-r">${totalHarga > 0 ? 'Rp ' + totalHarga.toLocaleString('id-ID') : '-'}</td>
                        <td class="px-4 py-3 whitespace-nowrap">
                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${getConditionColor(conditionValue)}">
                                ${conditionValue}
                            </span>
                        </td>
                    </tr>
                `;
            });
            
            tableHTML += `
                    </tbody>
                    <tfoot class="bg-gradient-to-r from-gray-50 to-gray-100">
                        <tr class="font-bold">
                            <td colspan="6" class="px-4 py-4 text-sm font-bold text-gray-900 text-right border-r">TOTAL:</td>
                            <td class="px-4 py-4 text-sm font-bold text-gray-900 text-center border-r">${totalJumlah}</td>
                            <td class="px-4 py-4 text-sm font-bold text-gray-900 border-r">-</td>
                            <td class="px-4 py-4 text-sm font-bold text-blue-900 border-r">Rp ${totalNilai.toLocaleString('id-ID')}</td>
                            <td class="px-4 py-4 text-sm font-bold text-gray-900">${filteredAssets.length} Barang</td>
                        </tr>
                    </tfoot>
                </table>
                
                <div class="mt-6 grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                        <h4 class="font-semibold text-blue-900 mb-2">Ringkasan Laporan</h4>
                        <p class="text-sm text-blue-800">Total Barang: <span class="font-bold">${filteredAssets.length}</span></p>
                        <p class="text-sm text-blue-800">Total Kuantitas: <span class="font-bold">${totalJumlah}</span></p>
                        <p class="text-sm text-blue-800">Total Nilai: <span class="font-bold">Rp ${totalNilai.toLocaleString('id-ID')}</span></p>
                        <p class="text-sm text-blue-800">Rata-rata Nilai per Barang: <span class="font-bold">Rp ${filteredAssets.length > 0 ? Math.round(totalNilai / filteredAssets.length).toLocaleString('id-ID') : '0'}</span></p>
                    </div>
                    
                    <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                        <h4 class="font-semibold text-green-900 mb-2">Kondisi Aset</h4>
                        <p class="text-sm text-green-800">Baik: <span class="font-bold">${filteredAssets.filter(a => {
                            const cond = db.conditions[a.id];
                            const condVal = typeof cond === 'object' ? cond.condition : (cond || 'Baik');
                            return condVal === 'Baik';
                        }).length}</span></p>
                        <p class="text-sm text-yellow-800">Rusak Ringan: <span class="font-bold">${filteredAssets.filter(a => {
                            const cond = db.conditions[a.id];
                            const condVal = typeof cond === 'object' ? cond.condition : (cond || 'Baik');
                            return condVal === 'Rusak Ringan';
                        }).length}</span></p>
                        <p class="text-sm text-red-800">Rusak Berat: <span class="font-bold">${filteredAssets.filter(a => {
                            const cond = db.conditions[a.id];
                            const condVal = typeof cond === 'object' ? cond.condition : (cond || 'Baik');
                            return condVal === 'Rusak Berat';
                        }).length}</span></p>
                        <p class="text-sm text-orange-800">Perlu Perbaikan/Pemeliharaan: <span class="font-bold">${filteredAssets.filter(a => {
                            const cond = db.conditions[a.id];
                            const condVal = typeof cond === 'object' ? cond.condition : (cond || 'Baik');
                            return condVal === 'Perlu Perbaikan/Pemeliharaan';
                        }).length}</span></p>
                    </div>
                    
                    <div class="bg-purple-50 border border-purple-200 rounded-lg p-4">
                        <h4 class="font-semibold text-purple-900 mb-2">Aksi</h4>
                        <button onclick="printLaporan()" class="w-full bg-purple-500 hover:bg-purple-600 text-white px-3 py-2 rounded-lg text-sm font-medium mb-2 transition-colors">
                            🖨️ Cetak Laporan
                        </button>
                        <button onclick="exportLaporanExcel()" class="w-full bg-green-500 hover:bg-green-600 text-white px-3 py-2 rounded-lg text-sm font-medium transition-colors">
                            📊 Export Excel
                        </button>
                    </div>
                </div>
            `;
            
            hasilDiv.innerHTML = tableHTML;
            showToast('Laporan berhasil dibuat!', 'success');
        }
        
        function updateStatistics() {
            const statsDiv = document.getElementById('statistikAset');
            
            // Calculate statistics berdasarkan data rekap aset
            const totalAset = db.assets.length;
            const totalNilai = db.assets.reduce((sum, asset) => {
                const hargaSatuan = parseInt(asset.hargaSatuan) || 0;
                const jumlah = parseInt(asset.jumlah) || 0;
                return sum + (hargaSatuan * jumlah);
            }, 0);
            
            // Group by sumber perolehan
            const sumberPerolehanStats = {};
            db.assets.forEach(asset => {
                const sumber = asset.sumberPerolehan || 'Tidak Diketahui';
                sumberPerolehanStats[sumber] = (sumberPerolehanStats[sumber] || 0) + 1;
            });
            
            // Group by tahun pembelian
            const tahunStats = {};
            db.assets.forEach(asset => {
                const tahun = asset.tahunPembelian || 'Tidak Diketahui';
                tahunStats[tahun] = (tahunStats[tahun] || 0) + 1;
            });
            
            // Group by kondisi
            const kondisiStats = { 'Baik': 0, 'Rusak Ringan': 0, 'Rusak Berat': 0, 'Perlu Perbaikan/Pemeliharaan': 0 };
            db.assets.forEach(asset => {
                const condition = db.conditions[asset.id];
                const conditionValue = typeof condition === 'object' ? condition.condition : (condition || 'Baik');
                kondisiStats[conditionValue] = (kondisiStats[conditionValue] || 0) + 1;
            });
            
            // Group by lokasi dari pengguna aset
            const lokasiStats = {};
            db.users.forEach(user => {
                const lokasi = user.lokasi || 'Tidak Diketahui';
                lokasiStats[lokasi] = (lokasiStats[lokasi] || 0) + parseInt(user.jumlahPengguna || 0);
            });
            
            statsDiv.innerHTML = `
                <div class="space-y-4">
                    <div class="border rounded-lg p-4 bg-gradient-to-r from-blue-50 to-blue-100">
                        <h4 class="font-semibold text-blue-900 mb-3 flex items-center">
                            <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                            </svg>
                            Ringkasan Umum
                        </h4>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <p class="text-sm text-blue-700">Total Barang:</p>
                                <p class="text-lg font-bold text-blue-900">${totalAset} Barang</p>
                            </div>
                            <div>
                                <p class="text-sm text-blue-700">Total Nilai:</p>
                                <p class="text-lg font-bold text-blue-900">Rp ${totalNilai.toLocaleString('id-ID')}</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="border rounded-lg p-4 bg-gradient-to-r from-green-50 to-green-100">
                        <h4 class="font-semibold text-green-900 mb-3 flex items-center">
                            <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M12 2l3.09 6.26L22 9l-5 4.87L18.18 21 12 17.77 5.82 21 7 13.87 2 9l6.91-.74L12 2z"/>
                            </svg>
                            Berdasarkan Sumber Perolehan
                        </h4>
                        ${Object.entries(sumberPerolehanStats).length > 0 ? 
                            Object.entries(sumberPerolehanStats).map(([sumber, jumlah]) => 
                                `<div class="flex justify-between items-center py-1">
                                    <span class="text-sm text-green-700">${sumber}:</span>
                                    <span class="font-semibold text-green-900">${jumlah} aset</span>
                                </div>`
                            ).join('') : 
                            '<p class="text-sm text-green-600 italic">Belum ada data</p>'
                        }
                    </div>
                    
                    <div class="border rounded-lg p-4 bg-gradient-to-r from-yellow-50 to-yellow-100">
                        <h4 class="font-semibold text-yellow-900 mb-3 flex items-center">
                            <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"/>
                            </svg>
                            Berdasarkan Tahun Pembelian
                        </h4>
                        ${Object.entries(tahunStats).length > 0 ? 
                            Object.entries(tahunStats)
                                .sort(([a], [b]) => b.localeCompare(a))
                                .slice(0, 5)
                                .map(([tahun, jumlah]) => 
                                    `<div class="flex justify-between items-center py-1">
                                        <span class="text-sm text-yellow-700">${tahun}:</span>
                                        <span class="font-semibold text-yellow-900">${jumlah} aset</span>
                                    </div>`
                                ).join('') : 
                            '<p class="text-sm text-yellow-600 italic">Belum ada data</p>'
                        }
                    </div>
                    
                    <div class="border rounded-lg p-4 bg-gradient-to-r from-purple-50 to-purple-100">
                        <h4 class="font-semibold text-purple-900 mb-3 flex items-center">
                            <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M3 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"/>
                            </svg>
                            Berdasarkan Kondisi Aset
                        </h4>
                        ${Object.entries(kondisiStats).map(([kondisi, jumlah]) => {
                            const percentage = totalAset > 0 ? ((jumlah / totalAset) * 100).toFixed(1) : 0;
                            const colorClass = kondisi === 'Baik' ? 'text-green-700' : 
                                             kondisi === 'Rusak Ringan' ? 'text-yellow-700' : 
                                             kondisi === 'Rusak Berat' ? 'text-red-700' : 
                                             kondisi === 'Perlu Perbaikan/Pemeliharaan' ? 'text-orange-700' : 'text-gray-700';
                            return `<div class="flex justify-between items-center py-1">
                                <span class="text-sm ${colorClass}">${kondisi}:</span>
                                <div class="text-right">
                                    <span class="font-semibold text-purple-900">${jumlah} aset</span>
                                    <span class="text-xs text-purple-600 ml-1">(${percentage}%)</span>
                                </div>
                            </div>`;
                        }).join('')}
                    </div>
                    
                    ${Object.keys(lokasiStats).length > 0 ? `
                    <div class="border rounded-lg p-4 bg-gradient-to-r from-indigo-50 to-indigo-100">
                        <h4 class="font-semibold text-indigo-900 mb-3 flex items-center">
                            <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd"/>
                            </svg>
                            Berdasarkan Lokasi Pengguna
                        </h4>
                        ${Object.entries(lokasiStats).map(([lokasi, jumlah]) => 
                            `<div class="flex justify-between items-center py-1">
                                <span class="text-sm text-indigo-700">${lokasi}:</span>
                                <span class="font-semibold text-indigo-900">${jumlah} unit</span>
                            </div>`
                        ).join('')}
                    </div>
                    ` : ''}
                </div>
            `;
        }
        
        function exportToExcel() {
            // Simulate Excel export
            showToast('Fitur export Excel akan segera tersedia', 'info');
        }
        
        function printLaporan() {
            const printContent = document.getElementById('hasilLaporan').innerHTML;
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html>
                <head>
                    <title>Laporan Aset</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; }
                        table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
                        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
                        th { background-color: #f2f2f2; font-weight: bold; }
                        .header { text-align: center; margin-bottom: 30px; }
                        .summary { display: none; }
                        @media print {
                            .summary { display: none; }
                            body { margin: 0; }
                        }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h2>LAPORAN DATA ASET</h2>
                        <p>Tanggal Cetak: ${new Date().toLocaleDateString('id-ID')}</p>
                    </div>
                    ${printContent}
                </body>
                </html>
            `);
            printWindow.document.close();
            printWindow.print();
        }
        
        function exportLaporanExcel() {
            // Create CSV content from current report data
            let csvContent = "No,Jenis Barang,Kode Barang,Merk/Type,Tahun,Sumber Perolehan,Jumlah,Harga Satuan,Total Harga,Kondisi\n";
            
            db.assets.forEach((asset, index) => {
                const condition = db.conditions[asset.id];
                const conditionValue = typeof condition === 'object' ? condition.condition : (condition || 'Baik');
                const hargaSatuan = parseInt(asset.hargaSatuan) || 0;
                const jumlah = parseInt(asset.jumlah) || 0;
                const totalHarga = parseInt(asset.totalHarga) || (hargaSatuan * jumlah);
                
                csvContent += `${asset.nomorUrut || (index + 1).toString().padStart(3, '0')},`;
                csvContent += `"${asset.jenisBarang || '-'}",`;
                csvContent += `"${asset.kodeBarang || '-'}",`;
                csvContent += `"${asset.merkType || '-'}",`;
                csvContent += `"${asset.tahunPembelian || '-'}",`;
                csvContent += `"${asset.sumberPerolehan || '-'}",`;
                csvContent += `${jumlah},`;
                csvContent += `${hargaSatuan},`;
                csvContent += `${totalHarga},`;
                csvContent += `"${conditionValue}"\n`;
            });
            
            // Create and download file
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `laporan-aset-${new Date().toISOString().split('T')[0]}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showToast('Laporan berhasil diexport ke CSV!', 'success');
        }
        
        // Laporan submenu functions
        function showLaporanSubMenu(subMenuId) {
            // Hide all laporan sub-menu contents
            document.querySelectorAll('.laporan-sub-content').forEach(el => {
                el.classList.add('hidden');
            });
            
            // Show selected sub-menu
            document.getElementById(subMenuId).classList.remove('hidden');
            
            // Update laporan sub-navigation buttons
            document.querySelectorAll('.laporan-nav-btn').forEach(btn => {
                btn.classList.remove('border-blue-500', 'text-blue-600');
                btn.classList.add('border-transparent', 'text-gray-500');
            });
            
            event.target.classList.remove('border-transparent', 'text-gray-500');
            event.target.classList.add('border-blue-500', 'text-blue-600');
            
            // Initialize data for specific submenu
            if (subMenuId === 'status-gudang') {
                generateStatusGudang();
            }
        }
        
        // Status Gudang functions
        function generateStatusGudang() {
            const filterStatus = document.getElementById('filterStatusGudang').value;
            const filterKondisi = document.getElementById('filterKondisiGudang').value;
            const searchTerm = document.getElementById('searchGudang').value.toLowerCase();
            
            // Determine warehouse status for each asset
            const warehouseData = db.assets.map(asset => {
                const condition = db.conditions[asset.id];
                const conditionValue = typeof condition === 'object' ? condition.condition : (condition || 'Baik');
                
                // Calculate total quantity being used by all users for this asset
                const usersOfThisAsset = db.users.filter(user => user.kodeBarangPengguna === asset.kodeBarang);
                const totalUsedQuantity = usersOfThisAsset.reduce((sum, user) => sum + (parseInt(user.jumlahPengguna) || 0), 0);
                
                // Calculate remaining quantity in warehouse
                const totalAssetQuantity = parseInt(asset.jumlah) || 0;
                const remainingQuantity = Math.max(0, totalAssetQuantity - totalUsedQuantity);
                
                // Determine status based on quantities and condition
                let status = 'tersedia';
                let statusLabel = 'Tersedia di Gudang';
                let statusColor = 'bg-green-100 text-green-800';
                
                // Priority 1: Check condition (rusak overrides everything)
                if (conditionValue === 'Rusak Berat' || conditionValue === 'Rusak Ringan' || conditionValue === 'Perlu Perbaikan/Pemeliharaan') {
                    status = 'rusak';
                    statusLabel = 'Rusak/Perlu Perbaikan';
                    statusColor = 'bg-red-100 text-red-800';
                }
                // Priority 2: Check if fully used (no remaining quantity)
                else if (totalUsedQuantity > 0 && remainingQuantity === 0) {
                    status = 'digunakan';
                    statusLabel = 'Sedang Digunakan (Habis)';
                    statusColor = 'bg-blue-100 text-blue-800';
                }
                // Priority 3: Check if partially used (some remaining quantity)
                else if (totalUsedQuantity > 0 && remainingQuantity > 0) {
                    status = 'sebagian';
                    statusLabel = 'Sebagian Digunakan';
                    statusColor = 'bg-yellow-100 text-yellow-800';
                }
                // Default: Available in warehouse
                else {
                    status = 'tersedia';
                    statusLabel = 'Tersedia di Gudang';
                    statusColor = 'bg-green-100 text-green-800';
                }
                
                return {
                    ...asset,
                    condition: conditionValue,
                    status: status,
                    statusLabel: statusLabel,
                    statusColor: statusColor,
                    totalQuantity: totalAssetQuantity,
                    usedQuantity: totalUsedQuantity,
                    remainingQuantity: remainingQuantity,
                    usersOfThisAsset: usersOfThisAsset,
                    isUsed: totalUsedQuantity > 0
                };
            });
            
            // Apply filters
            let filteredData = warehouseData.filter(item => {
                const matchesStatus = filterStatus === 'semua' || item.status === filterStatus;
                const matchesKondisi = filterKondisi === 'semua' || item.condition === filterKondisi;
                const matchesSearch = !searchTerm || 
                    item.jenisBarang.toLowerCase().includes(searchTerm) ||
                    item.kodeBarang.toLowerCase().includes(searchTerm);
                
                return matchesStatus && matchesKondisi && matchesSearch;
            });
            
            // Update summary cards
            updateWarehouseSummary(warehouseData);
            
            // Display results table
            displayWarehouseResults(filteredData);
        }
        
        function updateWarehouseSummary(data) {
            const summaryDiv = document.getElementById('summaryGudang');
            
            const tersedia = data.filter(item => item.status === 'tersedia').length;
            const sebagian = data.filter(item => item.status === 'sebagian').length;
            const digunakan = data.filter(item => item.status === 'digunakan').length;
            const rusak = data.filter(item => item.status === 'rusak').length;
            const total = data.length;
            
            // Calculate total remaining quantity in warehouse
            const totalSisaGudang = data.reduce((sum, item) => sum + item.remainingQuantity, 0);
            
            summaryDiv.innerHTML = `
                <div class="bg-gradient-to-r from-green-500 to-green-600 rounded-xl shadow-lg p-6 text-white">
                    <div class="flex items-center">
                        <div class="bg-green-400 rounded-full p-3 mr-4">
                            <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M4 4a2 2 0 00-2 2v1h16V6a2 2 0 00-2-2H4zM18 9H2v5a2 2 0 002 2h12a2 2 0 002-2V9z"/>
                            </svg>
                        </div>
                        <div>
                            <p class="text-green-100">Tersedia di Gudang</p>
                            <p class="text-2xl font-bold">${totalSisaGudang} Unit</p>
                            <p class="text-xs text-green-200">${tersedia} Jenis Barang</p>
                        </div>
                    </div>
                </div>
                <div class="bg-gradient-to-r from-yellow-500 to-yellow-600 rounded-xl shadow-lg p-6 text-white">
                    <div class="flex items-center">
                        <div class="bg-yellow-400 rounded-full p-3 mr-4">
                            <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M12 2l3.09 6.26L22 9l-5 4.87L18.18 21 12 17.77 5.82 21 7 13.87 2 9l6.91-.74L12 2z"/>
                            </svg>
                        </div>
                        <div>
                            <p class="text-yellow-100">Sebagian Digunakan</p>
                            <p class="text-2xl font-bold">${sebagian}</p>
                        </div>
                    </div>
                </div>
                <div class="bg-gradient-to-r from-blue-500 to-blue-600 rounded-xl shadow-lg p-6 text-white">
                    <div class="flex items-center">
                        <div class="bg-blue-400 rounded-full p-3 mr-4">
                            <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3z"/>
                            </svg>
                        </div>
                        <div>
                            <p class="text-blue-100">Sedang Digunakan (Habis)</p>
                            <p class="text-2xl font-bold">${digunakan}</p>
                        </div>
                    </div>
                </div>
                <div class="bg-gradient-to-r from-red-500 to-red-600 rounded-xl shadow-lg p-6 text-white">
                    <div class="flex items-center">
                        <div class="bg-red-400 rounded-full p-3 mr-4">
                            <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
                            </svg>
                        </div>
                        <div>
                            <p class="text-red-100">Rusak/Perlu Perbaikan</p>
                            <p class="text-2xl font-bold">${rusak}</p>
                        </div>
                    </div>
                </div>
            `;
        }
        
        function displayWarehouseResults(data) {
            const resultsDiv = document.getElementById('hasilStatusGudang');
            
            if (data.length === 0) {
                resultsDiv.innerHTML = '<p class="text-gray-500 text-center py-8">Tidak ada data yang sesuai dengan filter</p>';
                return;
            }
            
            let tableHTML = `
                <table class="min-w-full divide-y divide-gray-200 border border-gray-300">
                    <thead class="bg-gradient-to-r from-purple-50 to-pink-50">
                        <tr>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider border-r">No</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider border-r">Jenis Barang</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider border-r">Kode Barang</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider border-r">Merk/Type</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider border-r">Tahun</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider border-r">Total Stok</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider border-r">Digunakan</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider border-r">Sisa di Gudang</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider border-r">Kondisi</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider border-r">Status Gudang</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider border-r">Pengguna</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">Lokasi</th>
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200">
            `;
            
            data.forEach((item, index) => {
                // Create user list for display
                const usersList = item.usersOfThisAsset.length > 0 ? 
                    item.usersOfThisAsset.map(user => `
                        <div class="flex items-center mb-1">
                            <div class="bg-blue-100 rounded-full w-4 h-4 flex items-center justify-center mr-1">
                                <svg class="w-2 h-2 text-blue-600" fill="currentColor" viewBox="0 0 20 20">
                                    <path d="M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3z"/>
                                </svg>
                            </div>
                            <span class="text-xs">${user.namaPengguna} (${user.jumlahPengguna})</span>
                        </div>
                    `).join('') : '<span class="text-gray-400 italic text-xs">Tidak ada</span>';
                
                const locationsList = item.usersOfThisAsset.length > 0 ? 
                    [...new Set(item.usersOfThisAsset.map(user => user.lokasi))].map(lokasi => `
                        <div class="flex items-center mb-1">
                            <svg class="w-3 h-3 text-gray-400 mr-1" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd"/>
                            </svg>
                            <span class="text-xs">${lokasi}</span>
                        </div>
                    `).join('') : '<span class="text-gray-400 italic text-xs">Gudang</span>';
                
                tableHTML += `
                    <tr class="hover:bg-gray-50">
                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-900 border-r">${index + 1}</td>
                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-900 border-r font-medium">${item.jenisBarang || '-'}</td>
                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-900 font-mono border-r">${item.kodeBarang || '-'}</td>
                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-900 border-r">${item.merkType || '-'}</td>
                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-900 border-r">${item.tahunPembelian || '-'}</td>
                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-900 text-center border-r font-semibold">
                            <span class="bg-gray-100 px-2 py-1 rounded-full text-xs font-bold">${item.totalQuantity}</span>
                        </td>
                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-900 text-center border-r">
                            <span class="bg-blue-100 text-blue-800 px-2 py-1 rounded-full text-xs font-bold">${item.usedQuantity}</span>
                        </td>
                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-900 text-center border-r">
                            <span class="px-2 py-1 rounded-full text-xs font-bold ${item.remainingQuantity > 0 ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">${item.remainingQuantity}</span>
                        </td>
                        <td class="px-4 py-3 whitespace-nowrap border-r">
                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${getConditionColor(item.condition)}">
                                ${item.condition}
                            </span>
                        </td>
                        <td class="px-4 py-3 whitespace-nowrap border-r">
                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${item.statusColor}">
                                ${item.statusLabel}
                            </span>
                        </td>
                        <td class="px-4 py-3 text-sm text-gray-900 border-r max-w-xs">
                            ${usersList}
                        </td>
                        <td class="px-4 py-3 text-sm text-gray-900 max-w-xs">
                            ${locationsList}
                        </td>
                    </tr>
                `;
            });
            
            const totalStok = data.reduce((sum, item) => sum + item.totalQuantity, 0);
            const totalDigunakan = data.reduce((sum, item) => sum + item.usedQuantity, 0);
            const totalSisa = data.reduce((sum, item) => sum + item.remainingQuantity, 0);
            
            tableHTML += `
                    </tbody>
                    <tfoot class="bg-gradient-to-r from-gray-50 to-gray-100">
                        <tr class="font-bold">
                            <td colspan="5" class="px-4 py-4 text-sm font-bold text-gray-900 text-right border-r">TOTAL:</td>
                            <td class="px-4 py-4 text-sm font-bold text-gray-900 text-center border-r">
                                <span class="bg-gray-200 px-2 py-1 rounded-full">${totalStok}</span>
                            </td>
                            <td class="px-4 py-4 text-sm font-bold text-gray-900 text-center border-r">
                                <span class="bg-blue-200 text-blue-900 px-2 py-1 rounded-full">${totalDigunakan}</span>
                            </td>
                            <td class="px-4 py-4 text-sm font-bold text-gray-900 text-center border-r">
                                <span class="bg-green-200 text-green-900 px-2 py-1 rounded-full">${totalSisa}</span>
                            </td>
                            <td colspan="4" class="px-4 py-4 text-sm font-bold text-gray-900">${data.length} Jenis Barang</td>
                        </tr>
                    </tfoot>
                </table>
            `;
            
            resultsDiv.innerHTML = tableHTML;
        }
        
        function exportStatusGudang() {
            const filterStatus = document.getElementById('filterStatusGudang').value;
            const filterKondisi = document.getElementById('filterKondisiGudang').value;
            const searchTerm = document.getElementById('searchGudang').value.toLowerCase();
            
            // Get filtered data
            const warehouseData = db.assets.map(asset => {
                const condition = db.conditions[asset.id];
                const conditionValue = typeof condition === 'object' ? condition.condition : (condition || 'Baik');
                const isUsed = db.users.some(user => user.kodeBarangPengguna === asset.kodeBarang);
                const userInfo = isUsed ? db.users.find(user => user.kodeBarangPengguna === asset.kodeBarang) : null;
                
                let status = 'Tersedia di Gudang';
                if (isUsed) status = 'Sedang Digunakan';
                if (conditionValue === 'Rusak Berat' || conditionValue === 'Rusak Ringan' || conditionValue === 'Perlu Perbaikan/Pemeliharaan') {
                    status = 'Rusak/Perlu Perbaikan';
                }
                
                return {
                    ...asset,
                    condition: conditionValue,
                    status: status,
                    userInfo: userInfo
                };
            }).filter(item => {
                const matchesStatus = filterStatus === 'semua' || 
                    (filterStatus === 'tersedia' && item.status === 'Tersedia di Gudang') ||
                    (filterStatus === 'digunakan' && item.status === 'Sedang Digunakan') ||
                    (filterStatus === 'rusak' && item.status === 'Rusak/Perlu Perbaikan');
                const matchesKondisi = filterKondisi === 'semua' || item.condition === filterKondisi;
                const matchesSearch = !searchTerm || 
                    item.jenisBarang.toLowerCase().includes(searchTerm) ||
                    item.kodeBarang.toLowerCase().includes(searchTerm);
                
                return matchesStatus && matchesKondisi && matchesSearch;
            });
            
            // Create CSV content
            let csvContent = "No,Jenis Barang,Kode Barang,Merk/Type,Tahun,Total Stok,Digunakan,Sisa di Gudang,Kondisi,Status Gudang,Pengguna,Lokasi\n";
            
            warehouseData.forEach((item, index) => {
                const userNames = item.usersOfThisAsset.map(user => `${user.namaPengguna} (${user.jumlahPengguna})`).join('; ');
                const locations = [...new Set(item.usersOfThisAsset.map(user => user.lokasi))].join('; ');
                
                csvContent += `${index + 1},`;
                csvContent += `"${item.jenisBarang || '-'}",`;
                csvContent += `"${item.kodeBarang || '-'}",`;
                csvContent += `"${item.merkType || '-'}",`;
                csvContent += `"${item.tahunPembelian || '-'}",`;
                csvContent += `${item.totalQuantity},`;
                csvContent += `${item.usedQuantity},`;
                csvContent += `${item.remainingQuantity},`;
                csvContent += `"${item.condition}",`;
                csvContent += `"${item.statusLabel}",`;
                csvContent += `"${userNames || 'Tidak ada'}",`;
                csvContent += `"${locations || 'Gudang'}"\n`;
            });
            
            // Download file
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `status-gudang-${new Date().toISOString().split('T')[0]}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showToast('Status gudang berhasil diexport!', 'success');
        }
        
        function printStatusGudang() {
            const printContent = document.getElementById('hasilStatusGudang').innerHTML;
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html>
                <head>
                    <title>Status Barang di Gudang</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; }
                        table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
                        th, td { border: 1px solid #ddd; padding: 6px; text-align: left; font-size: 11px; }
                        th { background-color: #f2f2f2; font-weight: bold; }
                        .header { text-align: center; margin-bottom: 30px; }
                        @media print {
                            body { margin: 0; }
                        }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h2>STATUS BARANG DI GUDANG</h2>
                        <p>Tanggal Cetak: ${new Date().toLocaleDateString('id-ID')}</p>
                    </div>
                    ${printContent}
                </body>
                </html>
            `);
            printWindow.document.close();
            printWindow.print();
        }

        // Initialize dashboard on load
        updateDashboard();
        
        // Tracking functions
        function updateTrackingData() {
            updateTrackingFilters();
            displayTrackingResults();
            updateTrackingStatistics();
        }
        
        function updateTrackingFilters() {
            // Update location filter
            const lokasiFilter = document.getElementById('filterLokasi');
            const penggunaFilter = document.getElementById('filterPengguna');
            
            // Clear existing options
            lokasiFilter.innerHTML = '<option value="">Semua Lokasi</option>';
            penggunaFilter.innerHTML = '<option value="">Semua Pengguna</option>';
            
            // Get unique locations and users
            const locations = new Set();
            const users = new Set();
            
            db.users.forEach(user => {
                if (user.lokasi) locations.add(user.lokasi);
                if (user.namaPengguna) users.add(user.namaPengguna);
            });
            
            // Populate location filter
            locations.forEach(location => {
                const option = document.createElement('option');
                option.value = location;
                option.textContent = location;
                lokasiFilter.appendChild(option);
            });
            
            // Populate user filter
            users.forEach(user => {
                const option = document.createElement('option');
                option.value = user;
                option.textContent = user;
                penggunaFilter.appendChild(option);
            });
        }
        
        function applyTrackingFilter() {
            displayTrackingResults();
        }
        
        function displayTrackingResults() {
            const searchTerm = document.getElementById('searchTrackingBarang').value.toLowerCase();
            const lokasiFilter = document.getElementById('filterLokasi').value;
            const penggunaFilter = document.getElementById('filterPengguna').value;
            const resultsDiv = document.getElementById('trackingResults');
            
            // Filter users based on criteria
            let filteredUsers = db.users.filter(user => {
                const matchesSearch = !searchTerm || 
                    user.namaBarangPengguna.toLowerCase().includes(searchTerm) ||
                    user.kodeBarangPengguna.toLowerCase().includes(searchTerm) ||
                    user.namaPengguna.toLowerCase().includes(searchTerm);
                
                const matchesLokasi = !lokasiFilter || user.lokasi === lokasiFilter;
                const matchesPengguna = !penggunaFilter || user.namaPengguna === penggunaFilter;
                
                return matchesSearch && matchesLokasi && matchesPengguna;
            });
            
            if (filteredUsers.length === 0) {
                resultsDiv.innerHTML = '<p class="text-gray-500 text-center py-8">Tidak ada data yang sesuai dengan filter</p>';
                return;
            }
            
            // Create tracking table
            let tableHTML = `
                <table class="min-w-full divide-y divide-gray-200 border border-gray-300">
                    <thead class="bg-gradient-to-r from-blue-50 to-indigo-50">
                        <tr>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider border-r">No</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider border-r">Nama Barang</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider border-r">Kode Barang</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider border-r">No. Register</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider border-r">Pengguna</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider border-r">Jumlah</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider border-r">Lokasi</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider border-r">Kondisi</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider border-r">Spesifikasi</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">Status</th>
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200">
            `;
            
            filteredUsers.forEach((user, index) => {
                // Find corresponding asset
                const asset = db.assets.find(a => a.kodeBarang === user.kodeBarangPengguna);
                const condition = asset ? db.conditions[asset.id] : null;
                const conditionValue = typeof condition === 'object' ? condition.condition : (condition || 'Tidak Diketahui');
                
                // Determine status based on condition
                let status = 'Aktif';
                let statusColor = 'bg-green-100 text-green-800';
                
                if (conditionValue === 'Rusak Berat') {
                    status = 'Tidak Aktif';
                    statusColor = 'bg-red-100 text-red-800';
                } else if (conditionValue === 'Rusak Ringan' || conditionValue === 'Perlu Perbaikan/Pemeliharaan') {
                    status = 'Perlu Perhatian';
                    statusColor = 'bg-yellow-100 text-yellow-800';
                }
                
                tableHTML += `
                    <tr class="hover:bg-gray-50">
                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-900 border-r">${index + 1}</td>
                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-900 border-r font-medium">${user.namaBarangPengguna || '-'}</td>
                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-900 font-mono border-r">${user.kodeBarangPengguna || '-'}</td>
                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-900 font-mono border-r">${user.nomorRegisterPengguna || '-'}</td>
                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-900 border-r">
                            <div class="flex items-center">
                                <div class="bg-blue-100 rounded-full w-8 h-8 flex items-center justify-center mr-2">
                                    <svg class="w-4 h-4 text-blue-600" fill="currentColor" viewBox="0 0 20 20">
                                        <path d="M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3z"/>
                                    </svg>
                                </div>
                                <span class="font-medium">${user.namaPengguna || '-'}</span>
                            </div>
                        </td>
                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-900 text-center border-r font-semibold">${user.jumlahPengguna || '-'}</td>
                        <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-900 border-r">
                            <div class="flex items-center">
                                <svg class="w-4 h-4 text-gray-400 mr-1" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd"/>
                                </svg>
                                ${user.lokasi || '-'}
                            </div>
                        </td>
                        <td class="px-4 py-3 whitespace-nowrap border-r">
                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${getConditionColor(conditionValue)}">
                                ${conditionValue}
                            </span>
                        </td>
                        <td class="px-4 py-3 text-sm text-gray-900 border-r">
                            ${asset ? `
                                <div class="text-xs">
                                    <p><span class="font-medium">Merk:</span> ${asset.merkType || '-'}</p>
                                    <p><span class="font-medium">Tahun:</span> ${asset.tahunPembelian || '-'}</p>
                                    <p><span class="font-medium">Sumber:</span> ${asset.sumberPerolehan || '-'}</p>
                                </div>
                            ` : '<span class="text-gray-400 italic">Data tidak tersedia</span>'}
                        </td>
                        <td class="px-4 py-3 whitespace-nowrap">
                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${statusColor}">
                                ${status}
                            </span>
                        </td>
                    </tr>
                `;
            });
            
            tableHTML += `
                    </tbody>
                    <tfoot class="bg-gradient-to-r from-gray-50 to-gray-100">
                        <tr class="font-bold">
                            <td colspan="5" class="px-4 py-4 text-sm font-bold text-gray-900 text-right border-r">TOTAL:</td>
                            <td class="px-4 py-4 text-sm font-bold text-gray-900 text-center border-r">${filteredUsers.reduce((sum, user) => sum + (parseInt(user.jumlahPengguna) || 0), 0)}</td>
                            <td colspan="4" class="px-4 py-4 text-sm font-bold text-gray-900">${filteredUsers.length} Pengguna</td>
                        </tr>
                    </tfoot>
                </table>
            `;
            
            resultsDiv.innerHTML = tableHTML;
        }
        
        function updateTrackingStatistics() {
            // Calculate total distributed goods
            const totalDistributed = db.users.reduce((sum, user) => sum + (parseInt(user.jumlahPengguna) || 0), 0);
            document.getElementById('totalBarangTerdistribusi').textContent = totalDistributed;
            
            // Calculate total locations
            const uniqueLocations = new Set(db.users.map(user => user.lokasi).filter(loc => loc));
            document.getElementById('totalLokasi').textContent = uniqueLocations.size;
            
            // Calculate total active users
            document.getElementById('totalPenggunaAktif').textContent = db.users.length;
        }
        
        function exportTrackingData() {
            // Create CSV content for tracking data
            let csvContent = "No,Nama Barang,Kode Barang,No Register,Pengguna,Jumlah,Lokasi,Kondisi,Status\n";
            
            db.users.forEach((user, index) => {
                const asset = db.assets.find(a => a.kodeBarang === user.kodeBarangPengguna);
                const condition = asset ? db.conditions[asset.id] : null;
                const conditionValue = typeof condition === 'object' ? condition.condition : (condition || 'Tidak Diketahui');
                
                let status = 'Aktif';
                if (conditionValue === 'Rusak Berat') {
                    status = 'Tidak Aktif';
                } else if (conditionValue === 'Rusak Ringan' || conditionValue === 'Perlu Perbaikan/Pemeliharaan') {
                    status = 'Perlu Perhatian';
                }
                
                csvContent += `${index + 1},`;
                csvContent += `"${user.namaBarangPengguna || '-'}",`;
                csvContent += `"${user.kodeBarangPengguna || '-'}",`;
                csvContent += `"${user.nomorRegisterPengguna || '-'}",`;
                csvContent += `"${user.namaPengguna || '-'}",`;
                csvContent += `${user.jumlahPengguna || 0},`;
                csvContent += `"${user.lokasi || '-'}",`;
                csvContent += `"${conditionValue}",`;
                csvContent += `"${status}"\n`;
            });
            
            // Create and download file
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `tracking-barang-${new Date().toISOString().split('T')[0]}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showToast('Data tracking berhasil diexport!', 'success');
        }
        
        function printTrackingData() {
            const printContent = document.getElementById('trackingResults').innerHTML;
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html>
                <head>
                    <title>Tracking Barang</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; }
                        table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
                        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; font-size: 12px; }
                        th { background-color: #f2f2f2; font-weight: bold; }
                        .header { text-align: center; margin-bottom: 30px; }
                        @media print {
                            body { margin: 0; }
                        }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h2>TRACKING BARANG</h2>
                        <p>Tanggal Cetak: ${new Date().toLocaleDateString('id-ID')}</p>
                    </div>
                    ${printContent}
                </body>
                </html>
            `);
            printWindow.document.close();
            printWindow.print();
        }
        
        // Initialize nomor urut when page loads
        document.addEventListener('DOMContentLoaded', function() {
            generateNomorUrut();
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9947484c03456ce8',t:'MTc2MTQ1MzY5OC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
